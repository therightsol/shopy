premium={show_save_button:function(t){return this.get_template("console-user-tools-premium",{obj_user_data:t,button_text:this.strings.msg.save_chat})},show_chat_timer:function(t){var s=this;$("#YLC_sidebar_right").append(s.get_template("console-user-timer-premium",{timer_title:s.strings.msg.timer})),s.data.ref_cnv.child(t).once("value",function(e){if(null!==e.val()){var a=e.val();""==a.accepted_at?s.data.ref_cnv.child(t).child("accepted_at").set(Firebase.ServerValue.TIMESTAMP,function(){s.data.ref_cnv.child(t).once("value",function(t){if(null!==t.val()){var e=t.val();s.trigger_premium("set_timer",e.accepted_at)}})}):s.trigger_premium("set_timer",a.accepted_at)}})},set_timer:function(t){var s=this;s.objs.list_interval=setInterval(function(){var e=new Date,a=s.trigger_premium("chat_duration",t,e.getTime());$("#YLC_timer").html(a),$("#YLC_cnv_reply").is(":disabled")&&clearInterval(s.objs.list_interval)},1e3)},end_chat_console:function(t,s,e,a,i){var r=this;this.trigger_premium("save_user_data",t,s,e,s,function(t){r.objs.working=!1,a.removeClass("button-disabled"),i.html(t.error?t.error:t.msg),setTimeout(function(){i.fadeOut(2e3)},1e3),s&&setTimeout(function(){r.show_welcome_popup()},3e3)})},play_sound:function(t){function s(t,s){$("<source>").attr("src",s).appendTo(t)}var e=$("<audio />",{autoPlay:"autoplay"});s(e,ylc.plugin_url+"/sounds/"+t+".mp3"),s(e,ylc.plugin_url+"/sounds/"+t+".ogg"),s(e,ylc.plugin_url+"/sounds/"+t+".wav"),e.appendTo("body")},show_offline_form:function(){var t=this,s=!1;t.objs.popup_body.append(t.get_template("chat-offline-form-premium",{btn_text:t.strings.msg.send_btn,btn_styles:ylc.is_premium?t.trigger_premium("stylize","form_button"):"",field_name:t.strings.fields.name,name_ph:t.strings.fields.name_ph,field_email:t.strings.fields.email,email_ph:t.strings.fields.email_ph,field_message:t.strings.fields.message,message_ph:t.strings.fields.message_ph})),$(document).off("click","#YLC_send_btn"),$(document).on("click","#YLC_send_btn",function(){if(s)return!1;t.display_ntf(t.strings.msg.sending+"...","sending ");var e=$("#YLC_popup_form").serializeArray(),a=e.length-1;return $.each(e,function(e,i){if(t.data.current_form[i.name]=i.value,!i.value)return t.display_ntf(t.strings.msg.field_empty,"error"),!1;if("email"===i.name){if(!t.validate_email(i.value))return t.display_ntf(t.strings.msg.invalid_email,"error"),!1}else if("name"===i.name&&!t.validate_username(i.value))return t.display_ntf(t.strings.msg.invalid_username,"error"),!1;if(e===a){s=!0;var r=$("#YLC_popup_form").serialize()+"&vendor_id="+ylc.active_vendor.vendor_id;t.post("ylc_ajax_callback","offline_form",r,function(e){s=!1,e.error?t.display_ntf(e.error,"error"):e.warn?(t.display_ntf(e.warn,"success"),setTimeout(function(){t.clean_ntf(),t.minimize()},4e3)):(t.display_ntf(e.msg,"success"),setTimeout(function(){t.clean_ntf(),t.minimize()},2e3))})}}),!1}),$(document).on("mouseenter","#YLC_send_btn",function(){$(this).css("background-color",t.data.primary_hover)}),$(document).on("mouseleave","#YLC_send_btn",function(){$(this).css("background-color",t.opts.styles.bg_color)})},end_chat_options:function(t){if(t){var s=new Date;this.trigger_premium("save_user_data",this.data.user.conversation_id,!0,s.getTime(),!0)}ylc.chat_evaluation?this.trigger_premium("show_chat_evaluation"):ylc.send_transcript&&""!=this.data.user.user_email&&this.trigger_premium("show_copy_request")},show_chat_evaluation:function(){var t=this,s=!1;t.objs.popup_body.append(t.get_template("chat-evaluation-premium",{eval_text:t.strings.msg.chat_evaluation,good_text:t.strings.msg.good,bad_text:t.strings.msg.bad,transcript:ylc.send_transcript&&""!=t.data.user.user_email?t.get_template("chat-transcript-premium",{chat_copy:t.strings.msg.chat_copy}):""})),$(document).off("click","#YLC_good_btn, #YLC_bad_btn"),$(document).on("click","#YLC_good_btn, #YLC_bad_btn",function(){if(s)return!1;s=!0,t.display_ntf(t.strings.msg.sending+"...","sending");var e="YLC_good_btn"===$(this).attr("id")?"good":"bad",a=$("#YLC_request_chat").is(":checked")?1:0;return t.post("ylc_ajax_callback","chat_evaluation",{conversation_id:t.data.user.conversation_id,evaluation:e,receive_copy:a,user_email:t.data.user.user_email,chat_with:t.data.user.chat_with}),t.minimize(),!1})},show_copy_request:function(){var t=this,s=!1;t.objs.popup_body.append(t.get_template("chat-transcript-btn-premium",{chat_copy:t.strings.msg.chat_copy})),$(document).off("click","#YLC_chat_request"),$(document).on("click","#YLC_chat_request",function(){if(s)return!1;s=!0,t.display_ntf(t.strings.msg.sending+"...","sending");var e="",a=1;return t.post("ylc_ajax_callback","chat_evaluation",{conversation_id:t.data.user.conversation_id,evaluation:e,receive_copy:a,user_email:t.data.user.user_email,chat_with:t.data.user.chat_with}),t.minimize(),!1})},chat_duration:function(t,s){if(""==s||""==t)return"00:00:00";var e=.001*(s-t)>>0,a=e/60>>0,i=a/60>>0;return i%=60,a%=60,e%=60,i=10>i?"0"+i:i,a=10>a?"0"+a:a,e=10>e?"0"+e:e,i+":"+a+":"+e},save_user_data:function(t,s,e,a,i){var r=this;this.data.ref_cnv.child(t).once("value",function(o){var n=null!==o.val(),_=o.val();if(!n)return void(i&&i({}));var u=_.user_id,c=r.trigger_premium("chat_duration",_.accepted_at,e);r.data.ref_users.child(u).once("value",function(e){var o=e.val();o.created_at=_.created_at,o.evaluation=_.evaluation,o.duration=c,o.receive_copy=_.receive_copy,o.send_email=a,r.data.ref_msgs.once("value",function(e){var a=e.val(),n=a?Object.keys(a).length:0,_=0,c={};a?$.each(a,function(e,a){_+=1,a.conversation_id===t&&(c[e]=a,s&&r.data.ref_msgs.child(e).remove()),n===_&&(o.msgs=c,r.post("ylc_ajax_callback","save_chat",o,function(t){i&&i(t)}))}):i&&i({}),s&&(r.data.ref_users.child(u).remove(),r.data.ref_cnv.child(t).remove())})})})},set_avatar_premium:function(t,s){if("admin"!=t)return"https://www.gravatar.com/avatar/"+s.gravatar+".jpg?s=60&d="+ylc.default_user_avatar;switch(s.avatar_type){case"gravatar":return"https://www.gravatar.com/avatar/"+s.gravatar+".jpg?s=60&d="+ylc.default_admin_avatar;case"image":return s.avatar_image;default:return""!=ylc.company_avatar?ylc.company_avatar:this.data.assets_url+"/images/default-avatar-"+t+".png"}},stylize:function(t){var s=[];switch(t){case"chat_button":s=["color: "+this.data.primary_fg,"background-color: "+this.opts.styles.bg_color,"width:"+this.opts.styles.btn_width+"px","-webkit-border-radius:"+this.opts.styles.border_radius,"-moz-border-radius:"+this.opts.styles.border_radius,"border-radius:"+this.opts.styles.border_radius,this.opts.styles.x_pos+": 40px; "+("right"===this.opts.styles.x_pos?"left: auto":"right: auto"),this.opts.styles.y_pos+": 0; "+("top"===this.opts.styles.y_pos?"bottom: auto":"top: auto")];break;case"chat_widget":s=[this.opts.styles.x_pos+": 40px; "+("right"===this.opts.styles.x_pos?"left: auto":"right: auto"),this.opts.styles.y_pos+": 0; "+("top"===this.opts.styles.y_pos?"bottom: auto":"top: auto"),"-webkit-border-radius:"+this.opts.styles.border_radius,"-moz-border-radius:"+this.opts.styles.border_radius,"border-radius:"+this.opts.styles.border_radius];break;case"chat_header":s=["color: "+this.data.primary_fg,"background-color: "+this.opts.styles.bg_color];break;case"form_button":s=["color: "+this.data.primary_fg,"background-color: "+this.opts.styles.bg_color];break;case"chat_body":s=["-webkit-border-radius:"+this.opts.styles.border_radius,"-moz-border-radius:"+this.opts.styles.border_radius,"border-radius:"+this.opts.styles.border_radius];break;default:s=[]}return s.join("; ")},resize_chat:function(){var t=$(window).width();t>480?(this.objs.btn.css({width:this.opts.styles.btn_width+"px",left:"right"===this.opts.styles.x_pos?"auto":"40px",right:"left"===this.opts.styles.x_pos?"auto":"40px"}),this.objs.popup.css({left:"right"===this.opts.styles.x_pos?"auto":"40px",right:"left"===this.opts.styles.x_pos?"auto":"40px"}),$(".chat-body.chat-online").css("width",this.opts.styles.popup_width+"px"),$(".chat-body.chat-form").css("width",this.opts.styles.form_width+"px")):(this.objs.btn.css({width:"",left:"right"===this.opts.styles.x_pos?"auto":0,right:"left"===this.opts.styles.x_pos?"auto":0}),this.objs.popup.css({left:"right"===this.opts.styles.x_pos?"auto":0,right:"left"===this.opts.styles.x_pos?"auto":0}),this.objs.popup_body.css("width",""))},logged_users_auth:function(){""!=this.opts.user_info.user_name&&""!=this.opts.user_info.user_email&&(this.data.current_form={user_name:this.opts.user_info.user_name,user_email:this.opts.user_info.user_email,gravatar:this.md5(this.opts.user_info.user_email)},this.opts.display_login=!1)}};