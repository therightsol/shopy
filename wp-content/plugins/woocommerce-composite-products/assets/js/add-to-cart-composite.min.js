function wc_cp_toggle_element(a,b,c){return a.data("animating")===!0?!1:(a.hasClass("closed")?(setTimeout(function(){b.slideDown({duration:300,queue:!1,always:function(){a.data("animating",!1),"function"==typeof c&&c()}})},40),a.removeClass("closed").addClass("open"),a.data("animating",!0)):(setTimeout(function(){b.slideUp({duration:300,queue:!1,always:function(){a.data("animating",!1),"function"==typeof c&&c()}})},40),a.removeClass("open").addClass("closed"),a.data("animating",!0)),!0)}function wc_cp_scroll_viewport(a,b){var c,d,e="undefined"==typeof b.partial?!0:b.partial,f="undefined"==typeof b.offset?50:b.offset,g="undefined"==typeof b.timeout?5:b.timeout,h="undefined"==typeof b.duration?250:b.duration,i="undefined"==typeof b.queue?!1:b.queue,j="undefined"==typeof b.always_on_complete?!1:b.always_on_complete,k="undefined"==typeof b.scroll_method?!1:b.scroll_method,l=!1,m=$wc_cp_window,n=$wc_cp_document;c="undefined"==typeof b.on_complete||b.on_complete===!1?function(){return!1}:b.on_complete;var o=function(){if("relative"===a)d=m.scrollTop()-f,l=!0;else if("absolute"===a)d=f,l=!0;else if(a.length>0&&a.is(":visible")&&!a.wc_cp_is_in_viewport(e)){var b=f;"bottom"===k||a.hasClass("scroll_bottom")?b=m.height()-a.outerHeight(!0)-f:"middle"===k&&(b=m.height()/3*2-a.outerHeight(!0)-f),d=a.offset().top-b,a.offset().top<d&&(d=a.offset().top),l=!0}if(l){d>n.height()-m.height()&&(d=n.height()-m.height()-100);var g=jQuery("html").scrollTop(),o="body";jQuery("html").scrollTop(jQuery("html").scrollTop()-1),g!=jQuery("html").scrollTop()&&(o="html"),jQuery(o).animate({scrollTop:d},{duration:h,queue:i,always:c})}else j&&c()};g>0?setTimeout(function(){o()},g):o()}function wc_cp_woocommerce_number_format(a){var b=wc_composite_params.currency_format_decimal_sep,c=wc_composite_params.currency_position,d=wc_composite_params.currency_symbol,e=wc_composite_params.currency_format_trim_zeros,f=wc_composite_params.currency_format_num_decimals;if("yes"==e&&f>0){for(var g=0;f>g;g++)b+="0";a=a.replace(b,"")}var h="";return"left"==c?h='<span class="amount">'+d+a+"</span>":"right"==c?h='<span class="amount">'+a+d+"</span>":"left_space"==c?h='<span class="amount">'+d+" "+a+"</span>":"right_space"==c&&(h='<span class="amount">'+a+" "+d+"</span>"),h}function wc_cp_number_format(a){var b=wc_composite_params.currency_format_num_decimals,c=wc_composite_params.currency_format_decimal_sep,d=wc_composite_params.currency_format_thousand_sep,e=a,f=isNaN(b=Math.abs(b))?2:b,g="undefined"==typeof c?",":c,h="undefined"==typeof d?".":d,i=0>e?"-":"",j=parseInt(e=Math.abs(+e||0).toFixed(f))+"",k=(k=j.length)>3?k%3:0;return i+(k?j.substr(0,k)+h:"")+j.substr(k).replace(/(\d{3})(?=\d)/g,"$1"+h)+(f?g+Math.abs(e-j).toFixed(f).slice(2):"")}function wc_cp_join(a){var b="",c=a.length;if(c>0)for(var d=0,e=0;c>e;e++)d++,b=1==c||1==d?a[e]:wc_composite_params.i18n_comma_sep.replace("%s",b).replace("%v",a[e]);return b}function wc_cp_get_variation_data(a,b){b="undefined"==typeof b?!1:b;var c=a.find(".attribute-options"),d=c.length,e=[],f="";return 0===d?"":(c.each(function(a){var b=jQuery(this),c=b.find("select").val();if(""===c)return e=[],f="",!1;var g=b.data("attribute_label"),h=b.find("select option:selected").text();e.push({meta_key:g,meta_value:h}),f=f+'<span class="meta_element"><span class="meta_key">'+b.data("attribute_label")+':</span> <span class="meta_value">'+b.find("select option:selected").text(),a!==d-1&&(f+=", "),f+="</span></span>"}),b?f:e)}var wc_cp_composite_scripts={},$wc_cp_body=jQuery(document.body),$wc_cp_window=jQuery(window),$wc_cp_document=jQuery(document),wc_cp_block_params={message:null,fadeIn:0,fadeOut:0,overlayCSS:{background:"rgba( 255, 255, 255, 0 )",opacity:1}},wc_cp_block_wait_params={message:null,fadeIn:200,fadeOut:200,overlayCSS:{background:"rgba( 255, 255, 255, 0 )",opacity:.6}};jQuery.fn.wc_cp_is_in_viewport=function(a,b,c){var d=$wc_cp_window;if(!(this.length<1)){var e=this.length>1?this.eq(0):this,f=e.get(0),g=d.width(),h=d.height(),i=b===!0?f.offsetWidth*f.offsetHeight:!0;if(c=c?c:"vertical","function"==typeof f.getBoundingClientRect){var j=f.getBoundingClientRect(),k=j.top>=0&&j.top<h,l=j.bottom>0&&j.bottom<=h,m=j.left>=0&&j.left<g,n=j.right>0&&j.right<=g,o=a?k||l:k&&l,p=a?m||n:m&&n;if("both"===c)return i&&o&&p;if("vertical"===c)return i&&o;if("horizontal"===c)return i&&p}else{var q=d.scrollTop(),r=q+h,s=d.scrollLeft(),t=s+g,u=e.offset(),v=u.top,w=v+e.height(),x=u.left,y=x+e.width(),z=a===!0?w:v,A=a===!0?v:w,B=a===!0?y:x,C=a===!0?x:y;if("both"===c)return!!i&&r>=A&&z>=q&&t>=C&&B>=s;if("vertical"===c)return!!i&&r>=A&&z>=q;if("horizontal"===c)return!!i&&t>=C&&B>=s}}},jQuery.fn.wc_get_composite_script=function(){var a=jQuery(this);if(!a.hasClass("composite_form"))return!1;var b=a.data("script_id");return"undefined"!=typeof wc_cp_composite_scripts[b]?wc_cp_composite_scripts[b]:!1},function(a,b){function c(c){var e=this;this.composite_id=c.$composite_data.data("container_id"),this.$composite_data=c.$composite_data,this.$composite_form=c.$composite_form,this.$composite_add_to_cart_button=c.$composite_form.find(".composite_add_to_cart_button"),this.$composite_navigation=c.$composite_form.find(".composite_navigation"),this.$composite_navigation_top=c.$composite_form.find(".composite_navigation.top"),this.$composite_navigation_bottom=c.$composite_form.find(".composite_navigation.bottom"),this.$composite_navigation_movable=c.$composite_form.find(".composite_navigation.movable"),this.$composite_pagination=c.$composite_form.find(".composite_pagination"),this.$composite_summary=c.$composite_form.find(".composite_summary"),this.$composite_summary_widget=a(".widget_composite_summary").filter(function(){return a(this).find(".widget_composite_summary_content_"+e.composite_id).length>0}),this.$components=c.$composite_form.find(".component"),this.$steps={},this.$composite_availability=c.$composite_data.find(".composite_availability"),this.$composite_price=c.$composite_data.find(".composite_price"),this.$composite_message=c.$composite_data.find(".composite_message"),this.$composite_message_content=c.$composite_data.find(".composite_message ul.msg"),this.$composite_button=c.$composite_data.find(".composite_button"),this.timers={on_resize_timer:!1},this.ajax_url="yes"===wc_composite_params.use_wc_ajax?woocommerce_params.wc_ajax_url:woocommerce_params.ajax_url,this.debug_tab_count=0,this.settings=c.$composite_data.data("composite_settings"),this.is_initialized=!1,this.has_transition_lock=!1,this.steps=[],this.step_factory=new d.WC_CP_Step_Factory,this.scenarios=new d.WC_CP_Scenarios_Manager(this),this.actions=new d.WC_CP_Actions_Dispatcher(this),this.filters=new d.WC_CP_Filters_Manager,this.router=!1,this.data_model=!1,this.view_classes=new d.WC_CP_Views(this),this.model_classes=new d.WC_CP_Models(this),this.composite_summary_view=!1,this.composite_pagination_view=!1,this.composite_navigation_view=!1,this.composite_validation_view=!1,this.composite_availability_view=!1,this.composite_price_view=!1,this.composite_add_to_cart_button_view=!1,this.composite_summary_widget_views=[],this.api={navigate_to_step:function(a){var b=e.get_step_by("id",a);return!1===b?!1:void e.navigate_to_step(b)},show_previous_step:function(){e.show_previous_step()},show_next_step:function(){e.show_next_step()},get_steps:function(){return e.get_steps()},get_components:function(){return e.get_components()},get_step:function(a){return e.get_step(a)},get_step_by:function(a,b){return e.get_step_by(a,b)},get_step_title:function(a){var b=e.get_step_by("id",a);return!1===b?!1:b.get_title()},get_step_slug:function(a){var b=e.get_step_by("id",a);return!1===b?!1:b.step_slug},get_current_step:function(){return e.get_current_step()},get_previous_step:function(){return e.get_previous_step()},get_next_step:function(){return e.get_next_step()},get_composite_totals:function(){return e.data_model.get("totals")},get_composite_stock_status:function(){return e.data_model.get("is_in_stock")?"in-stock":"out-of-stock"},get_composite_availability:function(){var a=e.composite_availability_view.get_components_availability_string();return""===a&&!1!==e.composite_availability_view.$composite_stock_status&&(a=e.composite_availability_view.$composite_stock_status.clone().wrap("<div></div>").parent().html()),a},get_composite_validation_status:function(){return e.data_model.get("passes_validation")?"pass":"fail"},get_composite_validation_messages:function(){return e.data_model.get("validation_messages")},get_composite_configuration:function(){var b={};return 0===e.get_components().length?!1:(a.each(e.get_components(),function(a,c){var d=e.api.get_component_configuration(c.component_id);b[c.component_id]=d}),b)},get_component_totals:function(a){return!1===e.get_step_by("id",a)?!1:e.data_model.get("component_"+a+"_totals")},get_component_stock_status:function(a){var b=e.get_step_by("id",a);return!1===b?!1:b.step_validation_model.get("is_in_stock")?"in-stock":"out-of-stock"},get_component_availability:function(a){var b=e.get_step_by("id",a);if(!1===b)return!1;var c=b.$component_summary_content.find(".component_wrap .stock");return c.length>0?c.clone().wrap("<div></div>").parent().html():""},get_component_validation_status:function(a){var b=e.get_step_by("id",a);return!1===b?!1:b.step_validation_model.get("passes_validation")?"pass":"fail"},get_component_validation_messages:function(a,b){var c=e.get_step_by("id",a);if(!1===c)return!1;var d="composite"===b?c.step_validation_model.get("composite_messages"):c.step_validation_model.get("component_messages");return d},get_component_configuration:function(a){var b=e.get_step_by("id",a),c=!1;return!1===b?c:(c={title:b.get_title(),selection_title:b.get_selected_product_title(!1),selection_meta:b.get_selected_product_meta(!1),product_id:b.get_selected_product(!1),variation_id:b.get_selected_variation(!1),product_valid:b.is_selected_product_valid(),variation_valid:b.is_selected_variation_valid(),quantity:b.get_selected_quantity(),product_type:b.get_selected_product_type()},c=e.filters.apply_filters("component_configuration",[c,b]))},is_priced_per_product:function(){return"yes"===e.data_model.price_data.per_product_pricing}},this.init=function(){e.$composite_data.trigger("wc-composite-initializing",[e]),this.actions.add_action("initialize_composite",function(){e.init_steps()},10,this).add_action("initialize_composite",function(){e.init_models()},20,this).add_action("initialize_composite",function(){e.actions.init()},30,this).add_action("initialize_composite",function(){e.on_resize_handler()},40,this).add_action("initialize_composite",function(){e.init_views()},50,this).add_action("initialize_composite",function(){e.scenarios.init()},60,this).add_action("initialize_composite",function(){e.console_log("debug:events","\nValidating Steps:"),e.debug_tab_count=e.debug_tab_count+2,a.each(e.get_steps(),function(a,b){b.validate()}),e.debug_tab_count=e.debug_tab_count-2,e.console_log("debug:events","\nValidation complete.")},70,this).add_action("initialize_composite",function(){e.get_current_step().show_step()},80,this).add_action("initialize_composite",function(){e.init_router()},90,this),this.actions.do_action("initialize_composite"),e.is_initialized=!0,this.actions.add_action("composite_initialized",function(){e.data_model.init()},10,this).add_action("composite_initialized",function(){e.render_views()},20,this),this.actions.do_action("composite_initialized")},this.init_router=function(){var a=e.get_current_step(),c=b.Router.extend({has_initial_route:!1,is_initialized:!1,routes:{":step_slug":"show_step"},show_step:function(a){var b=encodeURIComponent(a),c=e.get_step_by("slug",b);c&&(this.is_initialized||(this.has_initial_route=!0),c.is_locked()?(window.alert(wc_composite_params.i18n_step_not_accessible.replace(/%s/g,c.get_title())),e.router.navigate(e.get_current_step().step_slug)):(this.is_initialized&&wc_cp_scroll_viewport(e.$composite_form,{timeout:0,partial:!1,duration:0,queue:!1}),c.show_step()))}});$wc_cp_body.hasClass("single-product")&&$wc_cp_body.hasClass("postid-"+e.composite_id)&&(e.router=new c,b.history.start(),e.router.is_initialized=!0,"single"!==e.settings.layout&&!1===e.router.has_initial_route&&e.router.navigate(a.step_slug,{trigger:!1}))},this.init_steps=function(){e.console_log("debug:events","\nInitializing Steps..."),"paged"===e.settings.layout?"componentized"===e.settings.layout_variation?(e.$composite_form.find(".multistep.active").removeClass("active"),e.$composite_data.addClass("multistep active"),e.$composite_pagination.find(".pagination_element_review").remove(),e.$composite_summary_widget.hide()):e.$composite_data.prev().hasClass("multistep")?(e.$composite_data.addClass("multistep"),e.$composite_data.hide(),e.$composite_data.hasClass("composite_added_to_cart")&&(e.$composite_form.find(".multistep.active").removeClass("active"),e.$composite_data.addClass("active"))):(e.$composite_data.show(),e.$composite_data.find(".component_title").hide(),e.$composite_pagination.find(".pagination_element_review").remove()):"progressive"===e.settings.layout?(e.$components.show(),e.$composite_data.show()):"single"===e.settings.layout&&(e.$components.show(),e.$composite_data.show()),e.$steps=e.$composite_form.find(".multistep"),e.$composite_form.children(".component, .multistep").each(function(b){var c=e.step_factory.create_step(e,a(this),b);e.steps[b]=c}),e.$composite_navigation.removeAttr("style")},this.get_ajax_url=function(a){return"yes"===wc_composite_params.use_wc_ajax?this.ajax_url.toString().replace("%%endpoint%%",a):this.ajax_url},this.navigate_to_step=function(a){"object"==typeof a&&"function"==typeof a.show_step&&(a.show_step(),this.allow_history_updates()&&this.router.navigate(a.step_slug))},this.allow_history_updates=function(){return!1!==e.router&&"yes"===this.settings.update_browser_history&&e.is_initialized},this.show_previous_step=function(){a.each(e.get_steps(),function(a,b){return b.is_previous()?(e.navigate_to_step(b),!1):void 0})},this.show_next_step=function(){a.each(e.get_steps(),function(a,b){return b.is_next()?(e.navigate_to_step(b),!1):void 0})},this.get_steps=function(){return this.steps},this.get_components=function(){var b=[];return a.each(this.steps,function(a,c){c.is_component()&&b.push(c)}),b},this.get_step=function(b){var c=!1;return a.each(e.get_steps(),function(a,d){return d.step_id==b?(c=d,!1):void 0}),c},this.get_step_by=function(b,c){var d=!1;return"id"!==b&&"index"!==b&&"slug"!==b?!1:(a.each(e.get_steps(),function(a,e){return"id"===b&&String(e.step_id)===String(c)||"index"===b&&String(a)===String(c)||"slug"===b&&String(e.step_slug).toUpperCase()===String(c).toUpperCase()?(d=e,!1):void 0}),d)},this.get_current_step=function(){var b=!1;return a.each(e.get_steps(),function(a,c){return c.is_current()?(b=c,!1):void 0}),b},this.get_previous_step=function(){var b=!1;return a.each(e.get_steps(),function(a,c){return c.is_previous()?(b=c,!1):void 0}),b},this.get_next_step=function(){var b=!1;return a.each(e.get_steps(),function(a,c){return c.is_next()?(b=c,!1):void 0}),b},this.on_resize_handler=function(){var b=e.$composite_form.width();b<=wc_composite_params.small_width_threshold?e.$composite_form.addClass("small_width"):e.$composite_form.removeClass("small_width"),b>wc_composite_params.full_width_threshold?e.$composite_form.addClass("full_width"):e.$composite_form.removeClass("full_width"),wc_composite_params.legacy_width_threshold&&(b<=wc_composite_params.legacy_width_threshold?e.$composite_form.addClass("legacy_width"):e.$composite_form.removeClass("legacy_width")),e.is_initialized&&a.each(e.get_components(),function(a,b){if(b.component_selection_view.is_relocated()){var c=b.component_selection_view.get_content_relocation_params();if(c.relocate){var d=b.$component_options.find(".component_option_content_container"),e=c.reference;e.after(d)}}})},this.console_log=function(b,c){if(window.console&&"undefined"!=typeof c){var d=!1;if("error"===b?d=!0:_.contains(wc_composite_params.script_debug_level,b)?d=!0:a.each(wc_composite_params.script_debug_level,function(a,c){return b.indexOf(c)>-1?(d=!0,!1):void 0}),d){for(var f="",g=e.debug_tab_count;g>0;g--)f+="	";c="function"==typeof c.substring&&"\n"===c.substring(0,1)?c.replace("\n","\n"+f):f+c,window.console.log(c)}}},this.init_models=function(){a.each(e.get_steps(),function(a,b){b.step_validation_model=new e.model_classes.Step_Validation_Model(b),b.step_access_model=new e.model_classes.Step_Access_Model(b)}),a.each(e.get_components(),function(a,b){b.component_options_model=new e.model_classes.Component_Options_Model(b),b.component_selection_model=new e.model_classes.Component_Selection_Model(b)}),e.data_model=new e.model_classes.Composite_Data_Model},this.init_views=function(){e.console_log("debug:events","\nInitializing Views..."),this.composite_validation_view=new e.view_classes.Composite_Validation_View({is_in_widget:!1,el:e.$composite_message,$el_content:e.$composite_message_content,model:e.data_model}),this.composite_price_view=new e.view_classes.Composite_Price_View({is_in_widget:!1,el:e.$composite_price,model:e.data_model}),this.composite_availability_view=new e.view_classes.Composite_Availability_View({is_in_widget:!1,el:e.$composite_availability,model:e.data_model}),this.composite_add_to_cart_button_view=new e.view_classes.Composite_Add_To_Cart_Button_View({is_in_widget:!1,el:e.$composite_button,$el_button:e.$composite_add_to_cart_button,model:e.data_model}),e.$composite_pagination.length>0&&(e.composite_pagination_view=new e.view_classes.Composite_Pagination_View({el:e.$composite_pagination})),e.$composite_summary.length>0&&(e.composite_summary_view=new e.view_classes.Composite_Summary_View({is_in_widget:!1,el:e.$composite_summary})),e.$composite_navigation.length>0&&(e.composite_navigation_view=new e.view_classes.Composite_Navigation_View({el:e.$composite_navigation})),e.$composite_summary_widget.length>0&&e.$composite_summary_widget.each(function(a,b){e.composite_summary_widget_views.push(new e.view_classes.Composite_Widget_View({widget_count:a+1,el:b}))}),a.each(e.get_steps(),function(a,b){b.validation_view=new e.view_classes.Step_Validation_View(b,{el:b.$component_message,model:b.step_validation_model})}),a.each(e.get_components(),function(a,b){b.component_options_view=new e.view_classes.Component_Options_View(b,{el:this.$component_options,model:this.component_options_model}),b.component_selection_view=new e.view_classes.Component_Selection_View(b,{el:this.$component_content,model:this.component_selection_model}),b.component_title_view=new e.view_classes.Component_Title_View(b,{el:b.$el.find(".component_title")})}),a.each(e.get_components(),function(a,b){b.component_selection_view.init_dependencies()})},this.render_views=function(){e.console_log("debug:views","\nRendering Views..."),e.debug_tab_count=e.debug_tab_count+2,a.each(e.get_components(),function(a,b){b.component_selection_view.update_selection_title(),b.component_options_view.render_options_state(),b.component_title_view.render_navigation_state(),e.actions.do_action("component_options_loaded",[b])}),!1!==e.composite_pagination_view&&e.composite_pagination_view.render(),!1!==e.composite_summary_view&&e.composite_summary_view.render(),!1!==e.composite_navigation_view&&e.composite_navigation_view.render("transition"),a.each(e.composite_summary_widget_views,function(a,b){b.composite_summary_view.render()}),e.debug_tab_count=e.debug_tab_count-2,e.console_log("debug:views","\nRendering complete."),e.$composite_form.removeClass("cp-no-js"),e.$composite_form.find(".cp-no-js-msg").remove()},this.block=function(a){this.$composite_form.block(wc_cp_block_params),a.block(wc_cp_block_wait_params),e.has_transition_lock=!0},this.unblock=function(a){this.$composite_form.unblock(),a.unblock(),e.has_transition_lock=!1}}var d={};d.WC_CP_Models=function(c){this.Composite_Data_Model=function(d){var e=b.Model.extend({price_data:c.$composite_data.data("price_data"),$nyp:!1,initialize:function(){var b={passes_validation:!0,validation_messages:[],is_in_stock:!0,stock_statuses:[],totals:{price:"",regular_price:"",price_incl_tax:"",price_excl_tax:""}};a.each(c.get_components(),function(a,c){b["component_"+c.component_id+"_totals"]={price:"",regular_price:"",price_incl_tax:"",price_excl_tax:""}}),this.set(b),this.price_data.suffix_exists=""!==wc_composite_params.price_display_suffix,this.price_data.suffix_contains_price_incl=wc_composite_params.price_display_suffix.indexOf("{price_including_tax}")>-1,this.price_data.suffix_contains_price_excl=wc_composite_params.price_display_suffix.indexOf("{price_excluding_tax}")>-1,c.actions.add_action("component_addons_changed",this.addons_changed_handler,10,this),c.actions.add_action("component_nyp_changed",this.nyp_changed_handler,10,this),c.actions.add_action("component_quantity_changed",this.quantity_changed_handler,10,this),c.actions.add_action("component_selection_changed",this.selection_changed_handler,30,this),c.actions.add_action("component_selection_content_changed",this.selection_content_changed_handler,30,this),c.actions.add_action("component_validation_message_changed",this.validation_message_changed_handler,10,this),c.actions.add_action("component_totals_changed",this.calculate_totals,10,this);var d=c.$composite_data.find(".nyp");d.length>0&&(this.$nyp=d,this.price_data.base_price=d.data("price"),c.$composite_data.on("woocommerce-nyp-updated-item",{model:this},function(a){var b=a.data.model;b.price_data.base_price=b.$nyp.data("price"),b.price_data.base_regular_price=b.$nyp.data("price"),b.update_totals()}))},init:function(){c.console_log("debug:models","\nInitializing composite data model..."),c.debug_tab_count=c.debug_tab_count+2,this.update_validation(),this.update_totals(),this.update_availability(),c.debug_tab_count=c.debug_tab_count-2},addons_changed_handler:function(a){return c.is_initialized?void this.update_totals(a):!1},nyp_changed_handler:function(a){return c.is_initialized?void this.update_totals(a):!1},selection_changed_handler:function(){return c.is_initialized?(this.update_totals(),void this.update_availability()):!1},selection_content_changed_handler:function(){return c.is_initialized?void this.update_availability():!1},quantity_changed_handler:function(a){return c.is_initialized?(this.update_totals(a),void this.update_availability()):!1},validation_message_changed_handler:function(){this.update_validation()},update_validation:function(){var a=[];this.is_purchasable()?a=this.get_validation_messages():a.push(wc_composite_params.i18n_unavailable_text),c.console_log("debug:models","\nUpdating 'Composite_Data_Model' validation state... Attribute count: \"validation_messages\": "+a.length+', Attribute: "passes_validation": '+(0===a.length).toString()),c.debug_tab_count=c.debug_tab_count+2,this.set({validation_messages:a,passes_validation:0===a.length}),c.debug_tab_count=c.debug_tab_count-2},get_validation_messages:function(){var b=[];a.each(c.get_steps(),function(c,d){var e=d.get_title();a.each(d.get_validation_messages("composite"),function(c,f){if(d.is_review())b.push({sources:!1,content:f.toString()});else{var g=!1;b.length>0&&a.each(b,function(a,c){if(c.content===f){var d=c.sources,h=c.content;return d.push(e),b[a]={sources:d,content:h},g=!0,!1}}),g||b.push({sources:[e],content:f.toString()})}})});var d=[];return b.length>0&&a.each(b,function(a,b){if(b.sources===!1)d.push(b.content);else{var c=wc_cp_join(b.sources);d.push(wc_composite_params.i18n_validation_issues_for.replace("%c",c).replace("%e",b.content))}}),d=c.filters.apply_filters("composite_validation_messages",[d])},is_purchasable:function(){return"no"===this.price_data.is_purchasable?!1:!0},update_availability:function(){var b=[],d=!0;a.each(c.get_components(),function(a,c){b.push(c.step_validation_model.get("is_in_stock"))}),d=_.contains(b,!1)?!1:!0,c.console_log("debug:models","\nUpdating 'Composite_Data_Model' availability... Attribute: \"stock_statuses\": "+b.toString()+', Attribute: "is_in_stock": '+d.toString()),c.debug_tab_count=c.debug_tab_count+2,this.set({stock_statuses:b,is_in_stock:d}),c.debug_tab_count=c.debug_tab_count-2},update_totals:function(b){var d=this;c.console_log("debug:models","\nUpdating 'Composite_Data_Model' totals..."),c.debug_tab_count=c.debug_tab_count+2,"undefined"==typeof b?(a.each(c.get_components(),function(a,b){d.update_component_prices(b)}),this.calculate_subtotals()):(this.update_component_prices(b),this.calculate_subtotals(b)),c.debug_tab_count=c.debug_tab_count-2},calculate_totals:function(){var b,d=this,e=Number(this.price_data.base_price),f=Number(this.price_data.base_regular_price),g=Number(this.price_data.base_price_tax);c.console_log("debug:models","\nAdding totals..."),b=this.get_taxed_totals(e,f,g),this.price_data.base_display_price=b.price,this.price_data.total=b.price,this.price_data.regular_total=b.regular_price,this.price_data.total_incl_tax=b.price_incl_tax,this.price_data.total_excl_tax=b.price_excl_tax,a.each(c.get_components(),function(a,b){var e=d.get("component_"+b.component_id+"_totals");e=c.filters.apply_filters("component_totals",[e,b]),d.price_data.total+=e.price,d.price_data.regular_total+=e.regular_price,d.price_data.total_incl_tax+=e.price_incl_tax,d.price_data.total_excl_tax+=e.price_excl_tax});var h={price:this.price_data.total,regular_price:this.price_data.regular_total,price_incl_tax:this.price_data.total_incl_tax,price_excl_tax:this.price_data.total_excl_tax};h=c.filters.apply_filters("composite_totals",[h]),c.debug_tab_count=c.debug_tab_count+2,this.set({totals:h}),c.debug_tab_count=c.debug_tab_count-2},get_taxed_totals:function(a,b,c){var d={price:a,regular_price:b,price_incl_tax:a,price_excl_tax:a};return c>0&&("yes"===wc_composite_params.prices_include_tax?(d.price_incl_tax=a,d.price_excl_tax=a/c):(d.price_incl_tax=a*c,d.price_excl_tax=a),"incl"===wc_composite_params.tax_display_shop?(d.price=d.price_incl_tax,"yes"===wc_composite_params.prices_include_tax?d.regular_price=b:d.regular_price=b*c):(d.price=d.price_excl_tax,"yes"===wc_composite_params.prices_include_tax?d.regular_price=b/c:d.regular_price=b)),d},calculate_subtotals:function(b){var d=this;b="undefined"==typeof b?!1:b,a.each(c.get_components(),function(a,e){if(!1!==b&&b.component_id!==e.component_id)return!0;var f={price:0,regular_price:0,price_incl_tax:0,price_excl_tax:0},g=d.price_data.quantities[e.component_id],h="variable"===e.get_selected_product_type()?e.get_selected_variation(!1):e.get_selected_product(!1),i=d.price_data.prices_tax[e.component_id],j=g*(d.price_data.regular_prices[e.component_id]+d.price_data.addons_prices[e.component_id]),k=g*(d.price_data.prices[e.component_id]+d.price_data.addons_prices[e.component_id]);c.console_log("debug:models",'Calculating "'+e.get_title()+'" totals...'),"yes"===wc_composite_params.calc_taxes?h>0&&g>0&&(k>0||j>0)&&(f=d.get_taxed_totals(k,j,i)):(f.price=k,f.regular_price=j,f.price_incl_tax=k,f.price_excl_tax=k),c.console_log("debug:models","Updating 'Composite_Data_Model' component totals... Attribute: \"component_"+e.component_id+'_totals".'),c.debug_tab_count=c.debug_tab_count+2,d.set("component_"+e.component_id+"_totals",f),c.debug_tab_count=c.debug_tab_count-2})},update_component_prices:function(a){c.console_log("debug:models",'Fetching "'+a.get_title()+'" price data...');var b=a.get_selected_quantity(),d=a.$component_data.data("custom");this.price_data.prices[a.component_id]=Number(a.$component_data.data("price")),this.price_data.regular_prices[a.component_id]=Number(a.$component_data.data("regular_price")),this.price_data.prices_tax[a.component_id]=1,"undefined"!=typeof d&&"undefined"!==d.price_tax&&(this.price_data.prices_tax[a.component_id]=Number(d.price_tax)),this.price_data.addons_prices[a.component_id]=Number(a.component_selection_model.get("selected_addons")),b>0?this.price_data.quantities[a.component_id]=parseInt(b):this.price_data.quantities[a.component_id]=0}}),f=new e(d);return f},this.Step_Validation_Model=function(a,d){var e=a,f=b.Model.extend({initialize:function(){var a={passes_validation:!0,is_in_stock:!0,component_messages:[],composite_messages:[]};this.set(a),c.actions.add_action("component_selection_changed",this.selection_changed_handler,20,this),c.actions.add_action("component_selection_content_changed",this.selection_content_changed_handler,20,this)},selection_changed_handler:function(){c.is_initialized&&e.validate()},selection_content_changed_handler:function(a){c.is_initialized&&a.step_id===e.step_id&&e.validate()},update:function(a,b){var d={passes_validation:a,is_in_stock:b,component_messages:e.get_validation_messages("component"),composite_messages:e.get_validation_messages("composite")};c.console_log("debug:models","\nUpdating 'Step_Validation_Model': \""+e.get_title()+'", Attribute: "passes_validation": '+d.passes_validation.toString()+', Attribute: "is_in_stock": '+d.is_in_stock.toString()),this.get("passes_validation")!==d.passes_validation?c.console_log("debug:models","Validation state changed.\n"):c.console_log("debug:models","Validation state unchanged.\n"),this.get("component_messages").length!==d.component_messages.length||this.get("component_messages").length!==_.intersection(this.get("component_messages"),d.component_messages).length?c.console_log("debug:models","Validation message changed.\n"):c.console_log("debug:models","Validation message unchanged.\n"),this.get("is_in_stock")!==d.is_in_stock?c.console_log("debug:models","Stock state changed.\n"):c.console_log("debug:models","Stock state unchanged.\n"),c.debug_tab_count=c.debug_tab_count+2,this.set(d),c.debug_tab_count=c.debug_tab_count-2}}),g=new f(d);return g},this.Step_Access_Model=function(a,d){var e=a,f=b.Model.extend({initialize:function(){var a={is_locked:!1},b=e.step_index>0?c.steps[e.step_index-1]:!1;this.set(a),!b||b.is_review()||"single"===c.settings.layout||"componentized"===c.settings.layout_variation&&("yes"!==c.settings.sequential_componentized_progress||e.is_review())||(this.listenTo(b.step_validation_model,"change:passes_validation",this.update_lock_state),this.listenTo(b.step_access_model,"change:is_locked",this.update_lock_state))},update_lock_state:function(){var a=c.steps[e.step_index-1],b=!1;a.step_access_model.get("is_locked")?b=!0:a.step_validation_model.get("passes_validation")||(b=!0),c.console_log("debug:models","\nUpdating 'Step_Access_Model': \""+e.get_title()+'", Attribute: "is_locked": '+b.toString()),this.get("is_locked")!==b?c.console_log("debug:models","Lock state changed.\n"):c.console_log("debug:models","Lock state unchanged.\n"),c.debug_tab_count=c.debug_tab_count+2,this.set({is_locked:b}),c.debug_tab_count=c.debug_tab_count-2}}),g=new f(d);return g},this.Component_Options_Model=function(d,e){var f=d,g=b.Model.extend({initialize:function(){var a=f.find_available_options(),b={filters:f.find_active_filters(),orderby:f.find_order_by(),current_page:f.find_pagination_param("current_page"),available_options:a,active_options:a.slice()};this.set(b),"single"===c.settings.layout?c.actions.add_action("active_scenarios_updated",this.refresh_options_state,10,this):(c.actions.add_action("active_scenarios_changed",this.refresh_options_state,10,this),c.actions.add_action("available_options_changed_"+f.step_id,this.available_options_changed_handler,10,this),c.actions.add_action("active_step_changed_"+f.step_id,this.active_step_changed_handler,10,this))},active_step_changed_handler:function(){this.refresh_options_state(f)},available_options_changed_handler:function(){this.refresh_options_state(f)},request_options:function(b,d){var e=this;this.set(b);var g={action:"woocommerce_show_component_options",load_page:this.get("current_page"),component_id:f.component_id,composite_id:c.composite_id,selected_option:f.get_selected_product(!1),filters:this.get("filters"),orderby:this.get("orderby")};a.post(c.get_ajax_url(g.action),g,function(a){e.trigger("component_options_data_loaded",a,d)},"json")},refresh_options:function(a){c.console_log("debug:models","\nUpdating 'Component_Options_Model': \""+f.get_title()+'", Attribute: "available_options": '+_.map(a,function(a){
return""===a?"0":a})),c.debug_tab_count=c.debug_tab_count+2,this.set({available_options:a}),c.debug_tab_count=c.debug_tab_count-2},refresh_options_state:function(b){c.console_log("debug:models","\nUpdating 'Component_Options_Model': \""+f.get_title()+'", Attribute: "active_options"...'),c.debug_tab_count=c.debug_tab_count+2;var d=[],e=[],g=b.step_index,h=f.component_id,i=c.scenarios.get_scenario_data().scenario_data,j=i[h],k=!1,l=!1,m=!1,n=!1,o=!1;if(b.is_review()&&(g=1e3),"single"===c.settings.layout&&"yes"!==c.settings.non_blocking_states&&c.is_initialized?k=!0:(k=!0,l=!0),e=c.scenarios.filter_scenarios_by_type(c.scenarios.calculate_active_scenarios(f,l,k),"compat_group"),c.console_log("debug:models","\nReference scenarios: ["+e+"]"),c.console_log("debug:models","Removing any scenarios where the current component is masked..."),e=c.scenarios.get_binding_scenarios_for(e,h),0===e.length&&e.push("0"),c.console_log("debug:models","Active scenarios: ["+e+"]"),0 in j)for(var p=j[0],q=0;q<p.length;q++){var r=p[q];if(a.inArray(r,e)>-1){m=!0;break}}else m=!1;if(m&&(c.console_log("debug:models","Component set as optional."),d.push("")),a.each(this.get("available_options"),function(b,g){if(""===g)return!0;var h=j[g],i=!1;c.console_log("debug:models","Updating selection #"+g+":"),c.console_log("debug:models","	Selection in scenarios: ["+h+"]");for(var k=0;k<h.length;k++){var l=h[k];if(a.inArray(l,e)>-1){i=!0;break}}i?(c.console_log("debug:models","	Selection enabled."),d.push(g)):(c.console_log("debug:models","	Selection disabled."),f.get_selected_product(!1)===g&&(n=!0,"single"===c.settings.layout&&"yes"!==c.settings.non_blocking_states&&!1===c.scenarios.has_invalid_product(f.step_index)&&(n=!1),n&&c.console_log("debug:models","	--- Selection invalid.")))}),"variable"===f.get_selected_product_type()){var s=f.get_selected_variation(),t=f.$component_data.data("product_variations");c.console_log("debug:models","	Checking variations..."),s>0&&c.console_log("debug:models","		--- Stored variation is #"+s);for(var u=0;u<t.length;u++){var v=t[u].variation_id,w=j[v],x=!1;c.console_log("debug:models","		Checking variation #"+v+":"),c.console_log("debug:models","		Selection in scenarios: ["+w+"]");for(var y=0;y<w.length;y++){var z=w[y];if(a.inArray(z,e)>-1){x=!0;break}}x?(c.console_log("debug:models","		Variation enabled."),d.push(v.toString())):(c.console_log("debug:models","		Variation disabled."),f.get_selected_variation(!1).toString()===v.toString()&&(o=!0,"single"===c.settings.layout&&"yes"!==c.settings.non_blocking_states&&!1===c.scenarios.has_invalid_variation(f.step_index)&&(o=!1),o&&c.console_log("debug:models","		--- Selection invalid.")))}}c.console_log("debug:models","Done.\n"),c.debug_tab_count=c.debug_tab_count-2,this.get("active_options").length!==d.length||this.get("active_options").length!==_.intersection(this.get("active_options"),d).length?c.console_log("debug:models","\nActive options changed - ["+_.map(this.get("active_options"),function(a){return""===a?"0":a})+"] => ["+_.map(d,function(a){return""===a?"0":a})+"].\n"):c.console_log("debug:models","\nActive options unchanged - ["+_.map(this.get("active_options"),function(a){return""===a?"0":a})+"] => ["+_.map(d,function(a){return""===a?"0":a})+"].\n"),c.debug_tab_count=c.debug_tab_count+2,this.set({active_options:d}),c.debug_tab_count=c.debug_tab_count-2,("single"===c.settings.layout||f.is_current())&&(c.console_log("debug:models",'\nChecking current "'+f.get_title()+'" selections:'),n?(c.console_log("debug:models","\nProduct selection invalid - resetting...\n\n"),c.debug_tab_count=c.debug_tab_count+2,f.component_selection_view.resetting_product=!0,f.$component_options_select.val("").change(),f.component_selection_view.resetting_product=!1,c.debug_tab_count=c.debug_tab_count-2):o?(c.console_log("debug:models","\nVariation selection invalid - resetting...\n\n"),c.debug_tab_count=c.debug_tab_count+2,f.component_selection_view.resetting_variation=!0,f.$component_summary_content.find(".reset_variations").trigger("click"),f.component_selection_view.resetting_variation=!1,c.debug_tab_count=c.debug_tab_count-2):c.console_log("debug:models","...looking good!"),(n||o)&&f.component_options_view.render_options_state())}}),h=new g(e);return h},this.Component_Selection_Model=function(d,e){var f=d,g=b.Model.extend({selected_product:"",selected_product_title:"",selected_variation_data:"",selected_product_image_src:"",selected_variation_image_src:"",initialize:function(){var a={selected_product:f.find_selected_product_param("id"),selected_variation:f.find_selected_product_param("variation_id"),selected_quantity:f.find_selected_product_param("quantity"),selected_addons:0,selected_nyp:0};this.selected_product=a.selected_product,this.selected_product_title=f.find_selected_product_param("title"),this.selected_product_image_src=f.find_selected_product_param("product_image_src"),this.selected_variation_image_src=f.find_selected_product_param("variation_image_src"),this.set(a)},request_details:function(b){var d=this,e={action:"woocommerce_show_composited_product",product_id:b,component_id:f.component_id,composite_id:c.composite_id};a.post(c.get_ajax_url(e.action),e,function(a){d.selected_product=b,d.trigger("component_selection_details_loaded",a)},"json")},update_selected_product:function(){var a="",b=f.find_selected_product_param("variation_id"),d=f.find_selected_product_param("quantity"),e=this.get("selected_product")!==this.selected_product,g=this.get("selected_variation")!==b,h=this.get("selected_quantity")!==d;e&&(this.selected_product_image_src=f.find_selected_product_param("product_image_src"),a='Attribute: "selected_product": #'+(""===this.selected_product?"0":this.selected_product)),g&&(b>0?(this.selected_variation_data=f.find_selected_product_param("variation_data"),this.selected_variation_image_src=f.find_selected_product_param("variation_image_src")):(this.selected_variation_data="",this.selected_variation_image_src=""),a=a+(""!==a?", ":"")+'Attribute: "selected_variation": #'+(""===b?"0":b)),h&&(a=a+(""!==a?", ":"")+'Attribute: "selected_quantity": '+d),(e||g||h)&&c.console_log("debug:models","\nUpdating 'Component_Selection_Model': \""+f.get_title()+'": '+a),this.selected_product_title=f.find_selected_product_param("title"),c.debug_tab_count=c.debug_tab_count+2,this.set({selected_product:this.selected_product,selected_variation:b,selected_quantity:d,selected_addons:0,selected_nyp:0}),c.debug_tab_count=c.debug_tab_count-2,this.trigger("selected_product_updated",this)},update_selected_variation:function(){var a=f.find_selected_product_param("variation_id");this.get("selected_variation")!==a&&(a>0?(this.selected_variation_data=f.find_selected_product_param("variation_data"),this.selected_variation_image_src=f.find_selected_product_param("variation_image_src")):(this.selected_variation_data="",this.selected_variation_image_src=""),c.console_log("debug:models","\nUpdating 'Component_Selection_Model': \""+f.get_title()+'", Attribute: "selected_variation": #'+(""===a?"0":a))),c.debug_tab_count=c.debug_tab_count+2,this.set({selected_variation:a}),c.debug_tab_count=c.debug_tab_count-2,this.trigger("selected_variation_updated",this)},update_selected_quantity:function(){var a=f.find_selected_product_param("quantity");this.get("selected_quantity")!==a&&c.console_log("debug:models","\nUpdating 'Component_Selection_Model': \""+f.get_title()+'", Attribute: "selected_quantity": '+a),c.debug_tab_count=c.debug_tab_count+2,this.set({selected_quantity:a}),c.debug_tab_count=c.debug_tab_count-2},update_selected_addons:function(){var a=f.find_selected_product_param("addons_price");this.get("selected_addons")!==a&&c.console_log("debug:models","\nUpdating 'Component_Selection_Model': \""+f.get_title()+'", Attribute: "selected_addons_price": '+a),c.debug_tab_count=c.debug_tab_count+2,this.set({selected_addons:a}),c.debug_tab_count=c.debug_tab_count-2},update_nyp:function(){var a=f.find_selected_product_param("nyp_price");this.get("selected_nyp")!==a&&c.console_log("debug:models","\nUpdating 'Component_Selection_Model': \""+f.get_title()+'", Attribute: "nyp_price": '+a),f.$component_data.data("price",a),f.$component_data.data("regular_price",a),c.debug_tab_count=c.debug_tab_count+2,this.set({selected_nyp:a}),c.debug_tab_count=c.debug_tab_count-2}}),h=new g(e);return h}},d.WC_CP_Views=function(c){this.Composite_Validation_View=function(d){var e=b.View.extend({render_timer:!1,$el_content:!1,is_in_widget:!1,initialize:function(a){this.$el_content=a.$el_content,this.is_in_widget=a.is_in_widget,c.actions.add_action("composite_validation_message_changed",this.render,100,this)},render:function(){var a=this,b=this.model;c.console_log("debug:views","\nScheduled update of composite validation view"+(this.is_in_widget?" (widget #"+this.is_in_widget+")":"")+"."),clearTimeout(a.render_timer),a.render_timer=setTimeout(function(){a.render_task(b)},10)},render_task:function(b){c.console_log("debug:views","\nUpdating composite validation view"+(this.is_in_widget?" (widget #"+this.is_in_widget+")":"")+"...");var d=b.is_purchasable(),e=b.get("validation_messages"),f=a("<ul/>"),g="validation_msg"+(this.is_in_widget||!1===d?"":" indented_validation_msg");!b.get("passes_validation")&&e.length>0?(d?f.append(a("<li/>").addClass("validation_msg").html(wc_composite_params.i18n_validation_issues)):g+=" non_purchasable_msg",a.each(e,function(b,c){f.append(a("<li/>").addClass(g).html(c))}),this.$el_content.html(f.html()),this.$el.removeClass("inactive").slideDown(200)):this.$el.addClass("inactive").slideUp(200)}}),f=new e(d);return f},this.Composite_Price_View=function(a){var d=b.View.extend({render_timer:!1,is_in_widget:!1,$addons_totals:!1,suffix:"",suffix_contains_price_incl:!1,suffix_contains_price_excl:!1,refreshing_addons_totals:!1,initialize:function(a){if(this.is_in_widget=a.is_in_widget,!this.is_in_widget){var b=c.$composite_data.find("#product-addons-total");b.length>0&&(this.$addons_totals=b,c.actions.add_action("composite_totals_changed",this.update_addons_totals,100,this),c.$composite_data.on("updated_addons",{view:this},this.updated_addons_handler),this.$el.after(b))}""!==wc_composite_params.price_display_suffix&&(this.suffix=' <small class="woocommerce-price-suffix">'+wc_composite_params.price_display_suffix+"</small>",this.suffix_contains_price_incl=wc_composite_params.price_display_suffix.indexOf("{price_including_tax}")>-1,this.suffix_contains_price_excl=wc_composite_params.price_display_suffix.indexOf("{price_excluding_tax}")>-1),c.actions.add_action("composite_totals_changed",this.render,100,this),c.actions.add_action("composite_validation_message_changed",this.render,100,this)},updated_addons_handler:function(a){var b=a.data.view;if(!1===b.refreshing_addons_totals&&b.model.get("passes_validation")){var d=b.model.get("totals"),e=0;b.refreshing_addons_totals=!0,b.$addons_totals.data("price",d.price),b.$addons_totals.data("raw-price",d.price),"yes"===wc_composite_params.calc_taxes&&("incl"===wc_composite_params.tax_display_shop?("yes"===wc_composite_params.prices_include_tax&&(e=b.$addons_totals.data("addons-price")*(1-1/b.model.price_data.base_price_tax)),b.$addons_totals.data("raw-price",d.price_excl_tax-e),b.$addons_totals.data("tax-mode","excl")):("no"===wc_composite_params.prices_include_tax&&(e=b.$addons_totals.data("addons-price")*(1-b.model.price_data.base_price_tax)),b.$addons_totals.data("raw-price",d.price_incl_tax-e),b.$addons_totals.data("tax-mode","incl"))),c.$composite_data.trigger("woocommerce-product-addons-update"),b.refreshing_addons_totals=!1}},update_addons_totals:function(){!1!==this.$addons_totals&&(this.$addons_totals.data("price",0),this.$addons_totals.data("raw-price",0),c.$composite_data.trigger("woocommerce-product-addons-update"))},render:function(){var a=this,b=this.model;c.console_log("debug:views","\nScheduled update of composite price view"+(this.is_in_widget?" (widget #"+this.is_in_widget+")":"")+"."),clearTimeout(a.render_timer),a.render_timer=setTimeout(function(){a.render_task(b)},10)},render_task:function(a){var b=a.get("totals");if(c.console_log("debug:views","\nUpdating composite price view"+(this.is_in_widget?" (widget #"+this.is_in_widget+")":"")+"..."),!a.get("passes_validation")||"yes"!==a.price_data.per_product_pricing&&a.price_data.total===a.price_data.base_display_price)this.$el.addClass("inactive").slideUp(200);else{if(0===b.price&&"yes"===a.price_data.show_free_string)this.$el.html('<p class="price"><span class="total">'+wc_composite_params.i18n_total+"</span>"+wc_composite_params.i18n_free+"</p>");else{var d=wc_cp_woocommerce_number_format(wc_cp_number_format(b.price)),e=wc_cp_woocommerce_number_format(wc_cp_number_format(b.regular_price)),f="",g="",h="";""!==this.suffix&&(f=this.suffix,this.suffix_contains_price_incl&&(g='<span class="amount">'+wc_cp_woocommerce_number_format(wc_cp_number_format(a.price_data.total_incl_tax))+"</span>",f=f.replace("{price_including_tax}",g)),this.suffix_contains_price_excl&&(h='<span class="amount">'+wc_cp_woocommerce_number_format(wc_cp_number_format(a.price_data.total_excl_tax))+"</span>",f=f.replace("{price_excluding_tax}",h))),b.regular_price>b.price?this.$el.html('<p class="price"><span class="total">'+wc_composite_params.i18n_total+"</span><del>"+e+"</del> <ins>"+d+"</ins>"+f+"</p>"):this.$el.html('<p class="price"><span class="total">'+wc_composite_params.i18n_total+"</span>"+d+f+"</p>")}this.$el.removeClass("inactive").slideDown(200)}}}),e=new d(a);return e},this.Composite_Availability_View=function(d){var e=b.View.extend({$composite_stock_status:!1,is_in_widget:!1,render_timer:!1,initialize:function(a){this.is_in_widget=a.is_in_widget,c.$composite_data.find(".composite_wrap p.stock").length>0&&(this.$composite_stock_status=c.$composite_data.find(".composite_wrap p.stock").clone()),c.actions.add_action("composite_availability_message_changed",this.render,100,this)},render:function(){var a=this,b=this.model;c.console_log("debug:views","\nScheduled update of composite availability view"+(this.is_in_widget?" (widget #"+this.is_in_widget+")":"")+"."),clearTimeout(a.render_timer),a.render_timer=setTimeout(function(){a.render_task(b)},10)},render_task:function(a){c.console_log("debug:views","\nUpdating composite availability view"+(this.is_in_widget?" (widget #"+this.is_in_widget+")":"")+"...");var b=this.get_components_availability_string();""!==b?this.$el.html(b).slideDown(200):!1!==this.$composite_stock_status?this.$el.html(this.$composite_stock_status).slideDown(200):this.$el.slideUp(200)},get_components_availability_string:function(){var b=[];a.each(c.get_components(),function(a,c){c.step_validation_model.get("is_in_stock")||b.push(c.get_title())});var d="";if(b.length>0){var e='<p class="stock out-of-stock">'+wc_composite_params.i18n_insufficient_stock+"</p>";d=e.replace("%s",wc_cp_join(b))}return d}}),f=new e(d);return f},this.Composite_Add_To_Cart_Button_View=function(d){var e=b.View.extend({render_timer:!1,is_in_widget:!1,$el_button:!1,$qty:!1,widget_qty_synced:!1,initialize:function(b){this.is_in_widget=b.is_in_widget,this.$el_button=b.$el_button,this.$el_qty=this.$el.find(".quantity input.qty"),c.actions.add_action("composite_availability_status_changed",this.render,100,this),c.actions.add_action("composite_validation_status_changed",this.render,100,this),this.is_in_widget||this.$el_button.on("click",function(){a.each(c.get_steps(),function(b,c){c.$el.find("select, input").each(function(){a(this).prop("disabled",!1)})})}),this.is_in_widget&&(this.$el_button.on("click",function(){c.composite_add_to_cart_button_view.$el_button.trigger("click")}),this.$el_qty.on("change",{view:this},function(a){var b=a.data.view;b.widget_qty_synced||(c.console_log("debug:views","\nCopying widget #"+b.is_in_widget+" quantity value into composite add-to-cart quantity field..."),b.widget_qty_synced=!0,c.composite_add_to_cart_button_view.$el_qty.val(b.$el_qty.val()).change(),b.widget_qty_synced=!1)}),c.composite_add_to_cart_button_view.$el_qty.on("change",{view:this},function(a){var b=a.data.view;c.console_log("debug:views","\nCopying composite add-to-cart quantity value into widget #"+b.is_in_widget+" quantity field..."),b.$el_qty.val(c.composite_add_to_cart_button_view.$el_qty.val()).change()}))},render:function(){var a=this,b=this.model;c.console_log("debug:views","\nScheduled update of composite add-to-cart button view"+(this.is_in_widget?" (widget #"+this.is_in_widget+")":"")+"."),clearTimeout(a.render_timer),a.render_timer=setTimeout(function(){a.render_task(b)},10)},render_task:function(a){c.console_log("debug:views","\nUpdating composite add-to-cart button view"+(this.is_in_widget?" (widget #"+this.is_in_widget+")":"")+"..."),a.get("passes_validation")&&a.get("is_in_stock")?"new"===c.settings.button_behaviour?this.$el_button.prop("disabled",!1).removeClass("disabled"):this.$el.slideDown(200):"new"===c.settings.button_behaviour?this.$el_button.prop("disabled",!0).addClass("disabled"):this.$el.slideUp(200)}}),f=new e(d);return f},this.Composite_Pagination_View=function(d){var e=b.View.extend({view_elements:{},initialize:function(){var b=this;a.each(c.get_steps(),function(a,d){b.view_elements[d.step_id]={$pagination_element:c.$composite_pagination.find(".pagination_element_"+d.step_id),$pagination_element_link:c.$composite_pagination.find(".pagination_element_"+d.step_id+" .element_link")},d.step_access_model.on("change:is_locked",function(){c.composite_pagination_view.render_element_state(d)})}),c.actions.add_action("active_step_changed",this.active_step_changed_handler,100,this),this.$el.on("click",".pagination_element a",this.clicked_pagination_element)},active_step_changed_handler:function(){this.render()},clicked_pagination_element:function(){if(a(this).blur(),c.has_transition_lock)return!1;if(a(this).hasClass("inactive"))return!1;var b=a(this).closest(".pagination_element").data("item_id"),d=c.get_step(b);return d&&c.navigate_to_step(d),!1},render:function(){return c.is_initialized?(c.console_log("debug:views","\nRendering pagination view elements state..."),c.debug_tab_count=c.debug_tab_count+2,a.each(c.get_steps(),function(a,b){c.composite_pagination_view.render_element_state(b)}),void(c.debug_tab_count=c.debug_tab_count-2)):!1},render_element_state:function(a){c.console_log("debug:views",'\nUpdating "'+a.get_title()+'" pagination view element state...'),a.is_current()?(this.view_elements[a.step_id].$pagination_element_link.addClass("inactive"),this.view_elements[a.step_id].$pagination_element.addClass("pagination_element_current")):a.is_locked()?(this.view_elements[a.step_id].$pagination_element_link.addClass("inactive"),this.view_elements[a.step_id].$pagination_element.removeClass("pagination_element_current")):(this.view_elements[a.step_id].$pagination_element_link.removeClass("inactive"),this.view_elements[a.step_id].$pagination_element.removeClass("pagination_element_current"))}}),f=new e(d);return f},this.Composite_Summary_View=function(d){var e=b.View.extend({update_price_timers:{},update_content_timers:{},view_elements:{},is_in_widget:!1,initialize:function(b){var d=this;this.is_in_widget=b.is_in_widget,a.each(c.get_steps(),function(a,b){b.step_access_model.on("change:is_locked",function(){d.render_element_state(b)}),b.step_validation_model.on("change:passes_validation",function(){d.render_element_content(b)})}),a.each(c.get_components(),function(a,b){d.view_elements[b.component_id]={$summary_element:d.$el.find(".summary_element_"+b.component_id),$summary_element_link:d.$el.find(".summary_element_"+b.component_id+" .summary_element_link"),$summary_element_wrapper:d.$el.find(".summary_element_"+b.component_id+" .summary_element_wrapper"),$summary_element_inner:d.$el.find(".summary_element_"+b.component_id+" .summary_element_wrapper_inner"),$summary_element_title:d.$el.find(".summary_element_"+b.component_id+" .summary_element_selection"),$summary_element_image:d.$el.find(".summary_element_"+b.component_id+" .summary_element_image"),$summary_element_price:d.$el.find(".summary_element_"+b.component_id+" .summary_element_price")}}),c.actions.add_action("component_quantity_changed",this.quantity_changed_handler,100,this),c.actions.add_action("component_selection_changed",this.selection_changed_handler,100,this),c.actions.add_action("component_selection_content_changed",this.selection_changed_handler,100,this),c.actions.add_action("component_totals_changed",this.component_totals_changed_handler,100,this),"single"!==c.settings.layout&&c.actions.add_action("active_step_changed",this.active_step_changed_handler,100,this),this.$el.on("click",".summary_element_link",this.clicked_summary_element),this.$el.on("click","a.summary_element_tap",function(){return a(this).closest(".summary_element_link").trigger("click"),!1})},active_step_changed_handler:function(){this.render_state()},selection_changed_handler:function(a){return c.is_initialized?void this.render_element_content(a):!1},quantity_changed_handler:function(a){this.render_element_content(a)},component_totals_changed_handler:function(a){this.render_element_price(a)},clicked_summary_element:function(){if(c.has_transition_lock)return!1;var b=c.$composite_form;if(a(this).hasClass("disabled"))return!1;var d=a(this).closest(".summary_element").data("item_id");if("undefined"==typeof d){var e=c.$composite_summary,f=e.find(".summary_element").index(a(this).closest(".summary_element"));d=b.find(".multistep.component:eq("+f+")").data("item_id")}var g=c.get_step(d);return g===!1?!1:(g.is_current()&&"single"!==c.settings.layout||c.navigate_to_step(g),!1)},render_state:function(){if(!c.is_initialized)return!1;var b=this;c.console_log("debug:views","\nRendering summary view element states"+(this.is_in_widget?" (widget #"+this.is_in_widget+")":"")+"..."),c.debug_tab_count=c.debug_tab_count+2,a.each(c.get_steps(),function(a,c){b.render_element_state(c)}),c.debug_tab_count=c.debug_tab_count-2},render_content:function(){var b=this;c.console_log("debug:views","\nRendering summary view element contents"+(this.is_in_widget?" (widget #"+this.is_in_widget+")":"")+"..."),c.debug_tab_count=c.debug_tab_count+2,a.each(c.get_steps(),function(a,c){b.render_element_content(c)}),c.debug_tab_count=c.debug_tab_count-2},render_price:function(){var b=this;c.console_log("debug:views","\nRendering summary view element prices"+(this.is_in_widget?" (widget #"+this.is_in_widget+")":"")+"..."),c.debug_tab_count=c.debug_tab_count+2,a.each(c.get_steps(),function(a,c){b.render_element_price(c)}),c.debug_tab_count=c.debug_tab_count-2},render:function(){c.console_log("debug:views","\nRendering summary view elements"+(this.is_in_widget?" (widget #"+this.is_in_widget+")":"")+"..."),c.debug_tab_count=c.debug_tab_count+2,this.render_price(),this.render_content(),this.render_state(),c.debug_tab_count=c.debug_tab_count-2},render_element_price:function(a){if(!c.is_initialized)return!1;var b=this;return"undefined"==typeof this.view_elements[a.step_id]?!1:(c.console_log("debug:views",'\nScheduled update of "'+a.get_title()+'" summary view element price'+(this.is_in_widget?" (widget #"+this.is_in_widget+")":"")+"."),"undefined"!=typeof this.update_price_timers[a.step_index]&&clearTimeout(b.update_price_timers[a.step_index]),void(this.update_price_timers[a.step_index]=setTimeout(function(){b.render_element_price_task(a)},10)))},render_element_price_task:function(a){c.console_log("debug:views",'\nRendering "'+a.get_title()+'" summary view element price'+(this.is_in_widget?" (widget #"+this.is_in_widget+")":"")+"...");var b=c.data_model.price_data;if(a.is_component()){var d=a,e=d.component_id,f=this.view_elements[e].$summary_element_price,g="variable"===d.get_selected_product_type()?d.get_selected_variation(!1):d.get_selected_product(!1),h=d.get_selected_quantity();if(g>0&&h>0){var i=c.data_model.get("component_"+e+"_totals");if("no"===b.per_product_pricing&&0===i.price&&0===i.regular_price)f.html("");else{var j=wc_cp_woocommerce_number_format(wc_cp_number_format(i.price)),k=wc_cp_woocommerce_number_format(wc_cp_number_format(i.regular_price));i.regular_price>i.price?f.html('<span class="price summary_element_content"><del>'+k+"</del> <ins>"+j+"</ins></span>"):f.html('<span class="price summary_element_content">'+j+"</span>")}}else f.html(' <span class="price summary_element_content" style="visibility:hidden;">&nbsp;</span>')}},render_element_content:function(a){if(!c.is_initialized)return!1;var b=this;return"undefined"==typeof this.view_elements[a.step_id]?!1:(c.console_log("debug:views",'\nScheduled update of "'+a.get_title()+'" summary view element content'+(this.is_in_widget?" (widget #"+this.is_in_widget+")":"")+"."),"undefined"!=typeof this.update_content_timers[a.step_index]&&clearTimeout(b.update_content_timers[a.step_index]),void(this.update_content_timers[a.step_index]=setTimeout(function(){b.render_element_content_task(a)},50)))},render_element_content_task:function(a){if(c.console_log("debug:views",'\nRendering "'+a.get_title()+'" summary view element content'+(this.is_in_widget?" (widget #"+this.is_in_widget+")":"")+"..."),a.is_component()){var b=a,d=b.component_id,e=this.view_elements[d].$summary_element_wrapper,f=this.view_elements[d].$summary_element_inner,g=this.view_elements[d].$summary_element_title,h=this.view_elements[d].$summary_element_image,i="",j="",k="",l=0,m=this.$el.is(":visible");if(m&&(l=f.outerHeight(!0),e.css("height",l)),i=b.get_selected_product_title(!0,!1),k=b.get_selected_product_image_src(!1),!1===this.is_in_widget&&(j=i&&b.passes_validation()?b.is_static()?'<a href="">'+wc_composite_params.i18n_summary_static_component+"</a>":'<a href="">'+wc_composite_params.i18n_summary_configured_component+"</a>":'<a href="">'+wc_composite_params.i18n_summary_empty_component+"</a>"),i?g.html('<span class="summary_element_content">'+i+"</span>"+(this.is_in_widget?"":'<span class="summary_element_content summary_element_selection_prompt">'+j+"</span>")):g.html(this.is_in_widget?"":'<span class="summary_element_content summary_element_selection_prompt">'+j+"</span>"),b.passes_validation()?e.addClass("configured"):e.removeClass("configured"),(a.is_current()&&m||this.is_in_widget)&&g.find(".summary_element_selection_prompt").hide(),this.render_summary_element_image(h,k),c.actions.do_action("component_summary_content_updated",[b,this]),m){var n=f.outerHeight(!0),o=!1;Math.abs(n-l)>1?o=!0:e.css("height","auto"),o&&(c.console_log("debug:events","Starting updated element content animation..."),e.animate({height:n},{duration:200,queue:!1,always:function(){c.console_log("debug:events","Ended updated element content animation."),e.css({height:"auto"})}}))}}},render_summary_element_image:function(a,b){var c=a.find("img");if(0==c.length||c.hasClass("norefresh"))return!1;var d=c.attr("data-o_src");b?("undefined"==typeof d&&(d=c.attr("src")?c.attr("src"):"",c.attr("data-o_src",d)),c.attr("src",b)):"undefined"!=typeof d&&c.attr("src",d)},render_element_state:function(a){if("undefined"==typeof this.view_elements[a.step_id])return!1;if(!c.is_initialized)return!1;var b=this.view_elements[a.step_id].$summary_element,d=this.view_elements[a.step_id].$summary_element_link;c.console_log("debug:views",'\nUpdating "'+a.get_title()+'" summary view element state'+(this.is_in_widget?" (widget #"+this.is_in_widget+")":"")+"..."),a.is_current()?(d.removeClass("disabled"),"single"!==c.settings.layout&&d.addClass("selected"),!1===c.get_step("review")&&b.find(".summary_element_selection_prompt").slideUp(200)):(b.find(".summary_element_selection_prompt").slideDown(200),a.is_locked()?(d.removeClass("selected"),d.addClass("disabled")):(d.removeClass("disabled"),d.removeClass("selected")))}}),f=new e(d);return f},this.Composite_Navigation_View=function(d){var e=b.View.extend({render_timer:!1,show_hide_timer:!1,updated_buttons_data:{},navi_in_step:!1,$el_progressive:c.$composite_form.find(".composite_navigation.progressive"),$el_paged_top:c.$composite_navigation_top,$el_paged_bottom:c.$composite_navigation_bottom,$el_paged_movable:c.$composite_navigation_movable,initialize:function(){c.actions.add_action("component_selection_changed",this.selection_changed_handler,100,this),c.actions.add_action("component_selection_content_changed",this.selection_changed_handler,100,this),c.actions.add_action("active_step_transition_start",this.active_step_transition_start_handler,100,this),this.$el.on("click",".page_button",this.clicked_navigation_button)},selection_changed_handler:function(a){if(!c.is_initialized)return!1;if(a.is_current()&&a.autotransition()&&a.passes_validation()&&!a.component_selection_view.resetting_product)return c.show_next_step(),!1;var b=this;c.console_log("debug:views","\nScheduling navigation UI update..."),clearTimeout(b.render_timer),b.render_timer=setTimeout(function(){b.render("change")},40)},active_step_transition_start_handler:function(){var a=this;clearTimeout(a.render_timer),a.render("transition")},clicked_navigation_button:function(){return a(this).blur(),a(this).hasClass("inactive")?!1:c.has_transition_lock?!1:(a(this).hasClass("next")?c.get_next_step()?c.show_next_step():wc_cp_scroll_viewport(c.$composite_form.find(".scroll_final_step"),{partial:!1,duration:250,queue:!1}):c.show_previous_step(),!1)},update_buttons:function(){var a=this.$el.find(".next"),b=this.$el.find(".prev");!1!==this.updated_buttons_data.button_next_html&&a.html(this.updated_buttons_data.button_next_html),!1!==this.updated_buttons_data.button_prev_html&&b.html(this.updated_buttons_data.button_prev_html),this.updated_buttons_data.button_next_visible?a.removeClass("invisible"):a.addClass("invisible"),this.updated_buttons_data.button_prev_visible?b.removeClass("invisible"):b.addClass("invisible"),this.updated_buttons_data.button_next_active?a.removeClass("inactive"):a.addClass("inactive")},render:function(a){c.console_log("debug:views","\nRendering navigation UI...");var b=c.get_current_step(),d=c.get_next_step(),e=c.get_previous_step(),f=this;if(this.updated_buttons_data={button_next_html:!1,button_prev_html:!1,button_next_visible:!1,button_prev_visible:!1,button_next_active:!1},"transition"===a&&"paged"===c.settings.layout&&"componentized"===c.settings.layout_variation&&(b.is_review()?this.$el_paged_bottom.hide():this.$el_paged_bottom.show()),b.is_component()&&(d&&"componentized"!==c.settings.layout_variation?(this.updated_buttons_data.button_next_html=wc_composite_params.i18n_next_step.replace("%s",d.get_title()),this.updated_buttons_data.button_next_visible=!0):"paged"===c.settings.layout&&(this.updated_buttons_data.button_next_html=wc_composite_params.i18n_final_step,this.updated_buttons_data.button_next_visible=!0)),b.passes_validation()||"componentized"===c.settings.layout_variation&&b.is_component())d&&(this.updated_buttons_data.button_next_active=!0),e&&"paged"===c.settings.layout&&e.is_component()?(this.updated_buttons_data.button_prev_html=wc_composite_params.i18n_previous_step.replace("%s",e.get_title()),this.updated_buttons_data.button_prev_visible=!0):this.updated_buttons_data.button_prev_html="";else if(e&&e.is_component()){var g=e.get_selected_product();(g>0||"0"===g||""===g&&e.is_optional())&&"paged"===c.settings.layout&&(this.updated_buttons_data.button_prev_html=wc_composite_params.i18n_previous_step.replace("%s",e.get_title()),this.updated_buttons_data.button_prev_visible=!0)}if("progressive"===c.settings.layout){var h=f.$el_progressive;if(f.navi_in_step!==b.step_id)h.slideUp({duration:200,always:function(){f.update_buttons(),h.appendTo(b.$inner_el).hide(),f.navi_in_step=b.step_id,setTimeout(function(){var a=!1;b.$el.hasClass("last")||b.passes_validation()&&!d.has_toggle()&&(a=!0),a&&h.slideDown({duration:200,queue:!1})},200)}});else{f.update_buttons();var i=!1;b.$el.hasClass("last")||b.passes_validation()&&!d.has_toggle()&&(i=!0),i?h.slideDown(200):h.slideUp(200)}}else if("paged"===c.settings.layout&&(f.navi_in_step!==b.step_id&&(b.$el.prepend(f.$el_paged_top),b.$el.append(f.$el_paged_bottom),f.navi_in_step=b.step_id),
f.update_buttons(),b.is_component()&&b.has_options_style("thumbnails")&&b.get_selected_product()>0)){var j=b.$component_content.find(".composite_navigation").length>0,k=!1,l=!b.$el.is(":visible")&&"transition"===a;if(b.append_results()&&b.component_selection_view.is_relocated()&&!1===b.$component_pagination.find(".component_options_load_more").is(":visible")){l&&b.$el.addClass("invisible").show();var m=f.$el_paged_bottom.offset().top-b.$component_content.offset().top-b.$component_content.outerHeight(!0);150>m&&(k=!0),l&&b.$el.hide().removeClass("invisible")}j||k||(f.$el_paged_movable.appendTo(b.$component_summary),j=!0),j&&(k||b.is_static()||!1===b.has_options_style("thumbnails")?f.$el_paged_movable.addClass("hidden"):f.$el_paged_movable.removeClass("hidden"))}}}),f=new e(d);return f},this.Composite_Widget_View=function(a){var d=b.View.extend({price_view:!1,show_hide_timer:!1,initialize:function(a){this.$el.removeClass("cp-no-js"),this.validation_view=new c.view_classes.Composite_Validation_View({is_in_widget:a.widget_count,el:this.$el.find(".widget_composite_summary_error .composite_message"),$el_content:this.$el.find(".widget_composite_summary_error .composite_message ul.msg"),model:c.data_model}),this.price_view=new c.view_classes.Composite_Price_View({is_in_widget:a.widget_count,el:this.$el.find(".widget_composite_summary_price .composite_price"),model:c.data_model}),this.availability_view=new c.view_classes.Composite_Availability_View({is_in_widget:a.widget_count,el:this.$el.find(".widget_composite_summary_availability .composite_availability"),model:c.data_model}),this.add_to_cart_button_view=new c.view_classes.Composite_Add_To_Cart_Button_View({is_in_widget:a.widget_count,el:this.$el.find(".widget_composite_summary_button .composite_button"),$el_button:this.$el.find(".widget_composite_summary_button .composite_button .composite_add_to_cart_button"),model:c.data_model}),this.composite_summary_view=new c.view_classes.Composite_Summary_View({is_in_widget:a.widget_count,el:this.$el.find(".widget_composite_summary_elements")}),"paged"===c.settings.layout&&c.actions.add_action("active_step_changed",this.active_step_changed_handler,100,this)},active_step_changed_handler:function(){this.show_hide()},show_hide:function(){var a=this;clearTimeout(a.show_hide_timer),this.show_hide_timer=setTimeout(function(){a.show_hide_task()},20)},show_hide_task:function(){var a=c.get_current_step().is_review();a?(this.$el.slideUp(250),this.$el.animate({opacity:0},{duration:250,queue:!1}),this.$el.addClass("inactive")):this.$el.hasClass("inactive")&&(this.$el.removeClass("inactive"),this.$el.slideDown(250),this.$el.animate({opacity:1},{duration:250,queue:!1}))}}),e=new d(a);return e},this.Step_Validation_View=function(d,e){var f=d,g=b.View.extend({render_timer:!1,render_html:!1,initialize:function(){var a=this;this.listenTo(this.model,"change:component_messages",function(){return f.is_current()&&"undefined"!=typeof f.$component_message&&"undefined"!=typeof f.$component_message_content?f.component_selection_view.resetting_product?!1:(c.console_log("debug:views",'\nScheduling "'+f.get_title()+'" validation message update...'),clearTimeout(a.render_timer),void(a.render_timer=setTimeout(function(){a.prepare_render("change"),a.render("change")},10))):!1}),"single"!==c.settings.layout&&c.actions.add_action("active_step_changed_"+f.step_id,this.active_step_changed_handler,100,this),"single"!==c.settings.layout&&c.actions.add_action("active_step_transition_end_"+f.step_id,this.active_step_transition_end_handler,100,this)},active_step_changed_handler:function(){return f.is_current()&&"undefined"!=typeof f.$component_message&&"undefined"!=typeof f.$component_message_content?void this.prepare_render("transition"):!1},active_step_transition_end_handler:function(){return f.is_current()&&"undefined"!=typeof f.$component_message&&"undefined"!=typeof f.$component_message_content?(clearTimeout(this.render_timer),void this.render("transition")):!1},prepare_render:function(b){var d;if(c.console_log("debug:views",'\nPreparing "'+f.get_title()+'" validation message update...'),this.render_html=!1,d=f.passes_validation()||"componentized"===c.settings.layout_variation&&f.is_component()?!1:!0,d&&(!f.$el.hasClass("last")||!f.$el.hasClass("progressive"))){var e=a("<ul/>"),g=f.get_validation_messages();g.length>0&&(a.each(g,function(b,c){e.append(a("<li/>").html(c))}),this.render_html=e.html())}"transition"===b&&!1===this.render_html&&("progressive"===c.settings.layout?f.has_toggle()&&f.$component_message.hide():"paged"===c.settings.layout&&f.$component_message.hide())},render:function(a){var b=this;if(c.console_log("debug:views",'\nUpdating "'+f.get_title()+'" validation message...'),!1!==this.render_html&&f.$component_message_content.html(this.render_html),"progressive"===c.settings.layout)"transition"===a?setTimeout(function(){!1===b.render_html?f.$component_message.slideUp(200):f.$component_message.slideDown(200)},200):!1===this.render_html?f.$component_message.slideUp(200):f.$component_message.slideDown(200);else if("paged"===c.settings.layout){var d=0;f.is_component()&&f.$component_content.hasClass("updating")&&!1!==this.render_html&&(d=600),f.is_component()&&f.$component_content.hasClass("relocating")&&(f.$component_message.hide(),d=600),setTimeout(function(){!1===b.render_html?f.$component_message.slideUp(200):f.$component_message.slideDown(200)},d)}}}),h=new g(e);return h},this.Component_Options_View=function(d,e){var f=d,g=b.View.extend({append_results_nesting:0,append_results_nesting_count:0,render_count:0,$blocked_element:!1,initialize:function(){f.$el.on("click",".component_filter_option a",{view:this},this.activate_filter),f.$el.on("click",".component_filters a.reset_component_filter",{view:this},this.reset_filter),f.$el.on("click",".component_filters a.reset_component_filters",{view:this},this.reset_filters),f.$el.on("click",".component_pagination a.component_pagination_element",{view:this},this.load_page),f.$el.on("click",".component_pagination a.component_options_load_more",{view:this},this.load_more),f.$el.on("change",".component_ordering select",{view:this},this.order_by),f.$el.on("click",".component_filter_title label",{view:this},this.toggle_filter),"progressive"===c.settings.layout&&f.$el.on("click",".block_component_selections_inner",{view:this},this.clicked_blocked_area),f.has_options_style("thumbnails")&&(f.$el.on("click",".component_option_thumbnail",{view:this},this.clicked_thumbnail),f.$el.on("click","a.component_option_thumbnail_tap",{view:this},this.clicked_thumbnail_tap)),f.has_options_style("radios")&&(f.$el.on("change",".component_option_radio_buttons input",{view:this},this.clicked_radio),f.$el.on("click","a.component_option_radio_button_tap",{view:this},this.clicked_radio_tap)),this.listenTo(this.model,"component_options_data_loaded",this.render_response),c.actions.add_action("active_options_changed_"+f.step_id,this.render_options_state,10,this)},clicked_blocked_area:function(){return c.navigate_to_step(f),!1},clicked_thumbnail_tap:function(){return a(this).closest(".component_option_thumbnail").trigger("click"),!1},clicked_thumbnail:function(){if(a(this).blur(),f.$el.hasClass("disabled")||a(this).hasClass("disabled"))return!0;if(!a(this).hasClass("selected")){var b=a(this).data("val");f.$component_options_select.val(b).change()}},clicked_radio_tap:function(){return a(this).closest(".component_option_radio_button").find("input").trigger("click"),!1},clicked_radio:function(){var b=a(this).closest(".component_option_radio_button");if(f.$el.hasClass("disabled")||b.hasClass("disabled"))return!0;if(!b.hasClass("selected")){var c=a(this).val();f.$component_options_select.val(c).change()}},toggle_filter:function(){a(this).blur();var b=a(this).closest(".component_filter"),c=b.find(".component_filter_content");return wc_cp_toggle_element(b,c),!1},activate_filter:function(b){if(a(this).blur(),f.$el.hasClass("disabled"))return!1;var d=b.data.view,e=a(this).closest(".component_filter_option");return e.hasClass("selected")?e.removeClass("selected"):e.addClass("selected"),d.update_filters_ui(),c.block(f.$component_filters),d.$blocked_element=f.$component_filters,setTimeout(function(){f.$component_selections.addClass("refresh_component_options"),f.component_options_model.request_options({current_page:1,filters:f.find_active_filters()},"reload")},120),!1},reset_filter:function(b){a(this).blur();var d=b.data.view,e=a(this).closest(".component_filter").find(".component_filter_option.selected");return 0==e.length?!1:(e.removeClass("selected"),d.update_filters_ui(),c.block(f.$component_filters),d.$blocked_element=f.$component_filters,setTimeout(function(){f.$component_selections.addClass("refresh_component_options"),f.component_options_model.request_options({current_page:1,filters:f.find_active_filters()},"reload")},120),!1)},reset_filters:function(b){a(this).blur();var d=b.data.view,e=f.$component_filters.find(".component_filter_option.selected");return 0==e.length?!1:(e.removeClass("selected"),d.update_filters_ui(),c.block(f.$component_filters),d.$blocked_element=f.$component_filters,setTimeout(function(){f.$component_selections.addClass("refresh_component_options"),f.component_options_model.request_options({current_page:1,filters:f.find_active_filters()},"reload")},120),!1)},update_filters_ui:function(){var b=f.$component_filters.find(".component_filter"),c=!0;return 0==b.length?!1:(b.each(function(){0==a(this).find(".component_filter_option.selected").length?a(this).removeClass("active"):(a(this).addClass("active"),c=!1)}),void(c?f.$component_filters.removeClass("filtered"):f.$component_filters.addClass("filtered")))},load_page:function(b){a(this).blur();var d=b.data.view,e=parseInt(a(this).data("page_num"));return e>0&&(c.block(f.$component_selections),d.$blocked_element=f.$component_selections,f.$component_selections.find(".blockUI").addClass("bottom"),setTimeout(function(){f.component_options_model.request_options({current_page:e},"reload")},120)),!1},load_more:function(b){a(this).blur();var d=b.data.view,e=parseInt(f.find_pagination_param("current_page")),g=parseInt(f.find_pagination_param("pages"));return e>0&&g>e&&(c.block(f.$component_options),d.$blocked_element=f.$component_options,f.$component_options.find(".blockUI").addClass("bottom"),setTimeout(function(){f.component_options_model.request_options({current_page:e+1},"append")},120)),!1},order_by:function(){var b=a(this).val();return a(this).blur(),c.block(f.$component_options),setTimeout(function(){f.component_options_model.request_options({current_page:1,orderby:b},"reload")},120),!1},render_options_state:function(){if(!c.is_initialized)return!1;this.render_count++,c.console_log("debug:views",'\nRendering "'+f.get_title()+'" options state...');var b,d,e,g,h,i,j=f.component_options_model,k=j.get("active_options"),l=f.get_selected_product(!1),m=f.$component_options_select,n=0,o=1;if(f.has_options_style("thumbnails")?(h=f.$component_options.find(".component_option_thumbnails"),o=parseInt(h.data("columns"))):f.has_options_style("radios")&&(i=f.$component_options.find(".component_option_radio_buttons")),m.data("select_options")||m.data("select_options",m.find("option:gt(0)").get()),m.find("option:gt(0)").remove(),m.append(m.data("select_options")),m.find("option:gt(0)").removeClass("disabled"),m.find("option:gt(0)").removeAttr("disabled"),f.has_options_style("thumbnails")?h.find(".no_compat_results").remove():f.has_options_style("radios")&&i.find(".no_compat_results").remove(),m.find("option:gt(0)").each(function(){var c=a(this).val(),h=_.contains(k,c);if(f.has_options_style("thumbnails")?(b=f.$component_options.find("#component_option_thumbnail_"+a(this).val()),d=b.closest(".component_option_thumbnail_container")):f.has_options_style("radios")&&(e=f.$component_options.find("#component_option_radio_button_"+a(this).val()),g=e.closest(".component_option_radio_button_container")),h?f.has_options_style("thumbnails")?b.removeClass("disabled"):f.has_options_style("radios")&&e.removeClass("disabled"):(l!==c?a(this).addClass("disabled"):a(this).prop("disabled","disabled"),f.has_options_style("thumbnails")?b.addClass("disabled"):f.has_options_style("radios")&&e.addClass("disabled")),f.has_options_style("thumbnails")&&f.append_results()){var i="";f.hide_disabled_products()&&!h?i="hidden":(n++,((n-1)%o==0||1==o)&&(i="first"),n%o==0&&(i+=" last")),d.removeClass("first last hidden"),i&&d.addClass(i)}f.has_options_style("radios")&&(h?(g.removeClass("hidden"),e.find("input").removeAttr("disabled")):(f.hide_disabled_products()&&g.addClass("hidden"),e.find("input").prop("disabled","disabled")))}),f.is_optional()?(f.has_options_style("radios")&&(e=f.$component_options.find("#component_option_radio_button_0"),g=e.closest(".component_option_radio_button_container"),e.removeClass("disabled"),e.find("input").removeAttr("disabled"),g.removeClass("hidden")),f.$component_options_select.find("option.none").html(wc_composite_params.i18n_none)):(f.has_options_style("radios")&&(e=f.$component_options.find("#component_option_radio_button_0"),g=e.closest(".component_option_radio_button_container"),f.hide_disabled_products()&&g.addClass("hidden"),e.addClass("disabled"),e.find("input").prop("disabled","disabled")),f.$component_options_select.find("option.none").html(wc_composite_params.i18n_select_an_option)),f.hide_disabled_products()){if(m.find("option.disabled").remove(),f.has_options_style("thumbnails")){var p=h.find(".component_option_thumbnail_container"),q=p.not(".hidden");p.length>0&&0==q.length?(h.find(".component_option_thumbnails_container").after('<p class="no_compat_results">'+wc_composite_params.i18n_no_compat_options+"</p>"),f.has_compat_results=!1,f.compat_results_count=0):(f.has_compat_results=!0,f.compat_results_count=q.length)}else if(f.has_options_style("radios")){var r=i.find(".component_option_radio_button_container"),s=r.not(".hidden");r.length>0&&0==s.length&&i.find(".component_option_radio_buttons_container").after('<p class="no_compat_results">'+wc_composite_params.i18n_no_compat_options+"</p>")}}else m.find("option.disabled").prop("disabled","disabled");if("variable"===f.get_selected_product_type()){for(var t,u=f.get_selected_variation(!1),v=f.$component_data.data("product_variations"),w=[],x=0;x<v.length;x++){var y=v[x].variation_id.toString(),z=_.contains(k,y);if("yes"!==wc_composite_params.is_wc_version_gte_2_3||f.hide_disabled_variations())z?w.push(v[x]):parseInt(u)===parseInt(y)&&(t=a.extend(!0,{},v[x]),t.variation_is_active=!1,w.push(t));else{var A=!1;if(t=a.extend(!0,{},v[x]),!z){t.variation_is_active=!1;for(var B in t.attributes)if(""===t.attributes[B]){A=!0;break}}A||w.push(t)}}f.$component_summary_content.data("product_variations",w),f.$component_summary_content.triggerHandler("reload_product_variations")}c.actions.do_action("options_state_rendered",[f])},render_response:function(b,d){var e=this,g=0,h=!1;if(g="undefined"!=typeof f.$component_options.get(0).getBoundingClientRect().height?f.$component_options.get(0).getBoundingClientRect().height:f.$component_options.outerHeight(),f.$component_options.css("height",g),"success"===b.result){var i=f.$component_options_select,j=f.get_selected_product(),k=f.get_selected_product(!1),l=a(b.options_markup),m=f.$component_options_inner.find(".component_option_thumbnails_container"),n=l.find(".component_option_thumbnail_container");if("append"===d&&f.append_results()&&n.find(".component_option_thumbnail").addClass("appended"),"append"===d){"undefined"!=typeof i.data("select_options")&&i.data("select_options")!==!1&&(i.find("option:gt(0)").remove(),i.append(i.data("select_options")),i.find("option:gt(0)").removeClass("disabled"),i.find("option:gt(0)").removeAttr("disabled"));var o=l.find("select.component_options_select option"),p=i.find('option[value="'+k+'"]');o=o.filter(":gt(0)"),k>0&&0==m.find("#component_option_thumbnail_"+k).length?(p.remove(),j>0&&m.find("#component_option_thumbnail_"+j).length>0&&(o=o.not(":selected"))):o=o.not(":selected"),o.appendTo(i),n.appendTo(m)}else f.component_options_model.trigger("component_options_flush",b,"reload"),f.$component_options_inner.html(a(l).find(".component_options_inner").html()),f.$component_options_select=i=f.$component_options_inner.find("select.component_options_select"),m=f.$component_options_inner.find(".component_option_thumbnails_container");var q=0,r=0,s=0,t=0,u=!1,v="";if(b.pagination_markup){var w=a(b.pagination_markup);v=w.html(),r=f.find_pagination_param("results_per_page",w),s=f.find_pagination_param("current_page",w),t=f.find_pagination_param("pages",w),q=t-s,f.append_results()?t>s&&(u=!0):u=!0}i.data("select_options",!1);var x=c.$composite_data.data("scenario_data");"append"===d?a.each(b.component_scenario_data,function(a,b){x.scenario_data[f.component_id][a]=b}):x.scenario_data[f.component_id]=b.component_scenario_data;var y=k;if(j=i.val(),y!==j)c.console_log("error","\nInitial selection not found in DOM.");else{if("append"===d&&f.append_results()&&f.hide_disabled_products()){var z,A,B;z=_.intersection(e.model.get("available_options"),e.model.get("active_options")).length,e.model.refresh_options(f.find_available_options()),A=_.intersection(e.model.get("available_options"),e.model.get("active_options")).length,B=A-z,e.append_results_nesting_count+=B,e.append_results_nesting_count<r&&q>0&&(e.append_results_nesting++,h=!0,e.append_results_nesting>10&&(window.confirm(wc_composite_params.i18n_reload_threshold_exceeded.replace("%s",f.get_title()))?e.append_results_nesting=0:h=!1))}else e.model.refresh_options(f.find_available_options());h||(e.append_results_nesting_count=0,e.append_results_nesting=0)}if(h)e.model.request_options({current_page:e.model.get("current_page")+1},"append");else{var C=e.render_count;C===e.render_count&&e.render_options_state(),c.actions.do_action("component_options_loaded",[f]),u?(f.$component_pagination.html(v),f.$component_pagination.slideDown(200)):f.$component_pagination.slideUp({duration:200,always:function(){f.$component_pagination.html(v)}});var D=f.$component_options_inner.find(".component_option_thumbnail_container:not(.hidden) img"),E=function(){if(D.length>0&&m.is(":visible")){var b=!1;D.each(function(){var c=a(this);return 0===c.height()?(b=!0,!1):void 0}),b?setTimeout(function(){E()},100):e.animate_component_options(d,g)}else e.animate_component_options(d,g)};setTimeout(function(){E()},10)}}else f.$component_options_inner.html(b.options_markup),e.animate_component_options(d,g)},animate_component_options:function(a,b){var d=this,e=f.$component_options_inner.outerHeight(!0),g=!1;Math.abs(e-b)>1?g=!0:f.$component_options.css("height","auto");var h={};f.append_results()&&(h=f.$component_selections.find(".appended"),h.removeClass("appended")),g?("append"===!a&&f.$component_selections.removeClass("refresh_component_options"),f.$component_options.animate({height:e},{duration:250,queue:!1,always:function(){f.$component_options.css({height:"auto"}),setTimeout(function(){f.$component_selections.removeClass("refresh_component_options"),c.unblock(d.$blocked_element)},100)}})):setTimeout(function(){f.$component_selections.removeClass("refresh_component_options"),c.unblock(d.$blocked_element)},250)}}),h=new g(e);return h},this.Component_Selection_View=function(d,e){var f=d,g=b.View.extend({$relocation_origin:!1,relocated:!1,relocate_component_content:!1,relocate_to_origin:!1,$relocation_target:!1,$relocation_reference:!1,load_height:0,resetting_product:!1,resetting_variation:!1,flushing_component_options:!1,update_selection_title_timer:!1,initialize:function(){f.$el.on("change",".component_options select.component_options_select",{view:this},this.option_changed),f.$el.on("woocommerce_variation_has_changed",{view:this},function(a){a.data.view.model.update_selected_variation(),f.$component_quantity.trigger("change"),f.$component_summary_content.find(".composited_product_images").removeClass("images")}),f.$el.on("woocommerce_variation_select_change",function(){f.$component_summary.find(".composited_product_images").addClass("images"),f.$component_data.data("price",0),f.$component_data.data("regular_price",0);var a=f.$component_data.data("custom");a.price_tax=1}),f.$el.on("found_variation",function(a,b){f.$component_data.data("price",b.price),f.$component_data.data("regular_price",b.regular_price);var c=f.$component_data.data("custom");c.price_tax=b.price_tax}),f.$el.on("change",".component_wrap input.qty",function(){var b=parseFloat(a(this).attr("min")),c=parseFloat(a(this).attr("max"));b>=0&&(parseFloat(a(this).val())<b||isNaN(parseFloat(a(this).val())))&&a(this).val(b),c>0&&parseFloat(a(this).val())>c&&a(this).val(c),f.initializing_scripts||f.component_selection_model.update_selected_quantity()}),f.$el.on("wc-composite-component-loaded",function(){a.isFunction(a.fn.prettyPhoto)&&f.$component_summary_content.find('a[data-rel^="prettyPhoto"]').prettyPhoto({hook:"data-rel",social_tools:!1,theme:"pp_woocommerce",horizontal_padding:20,opacity:.8,deeplinking:!1})}),f.$el.on("click",".clear_component_options",function(){if(a(this).hasClass("reset_component_options"))return!1;var b=f.$component_options_select;return b.val("").change(),!1}),f.$el.on("click",".reset_component_options",function(){var a=f.$component_options_select;return f.unblock_step_inputs(),f.set_active(),a.val("").change(),f.block_next_steps(),!1}),f.$el.on("updated_addons",this.updated_addons_handler),f.$el.on("woocommerce-nyp-updated-item",this.updated_nyp_handler),"yes"===wc_composite_params.relocated_content_reset_on_return&&c.actions.add_action("active_step_changed",this.active_step_changed_handler,110,this),this.listenTo(this.model,"component_selection_details_loaded",this.render_response),this.listenTo(f.component_options_model,"component_options_flush",this.component_options_flush_handler),c.actions.add_action("component_quantity_changed",this.quantity_changed_handler,100,this)},active_step_changed_handler:function(a){f.step_id===a.step_id&&this.is_relocated()&&this.reset_relocated_content()},quantity_changed_handler:function(a){a.step_id===f.step_id&&this.update_selection_title(this.model)},updated_addons_handler:function(){f.component_selection_model.update_selected_addons()},updated_nyp_handler:function(){f.component_selection_model.update_nyp()},update_selection_title:function(a){var b=this;a="undefined"==typeof a?b.model:a,f.get_selected_product_id()>0&&(c.console_log("debug:views",'\nScheduled update of "'+f.get_title()+'" selection title.'),clearTimeout(b.update_selection_title_timer),b.update_selection_title_timer=setTimeout(function(){b.update_selection_title_task(a)},10))},update_selection_title_task:function(a){c.console_log("debug:views",'\nUpdating "'+f.get_title()+'" selection title...');var b=parseInt(a.get("selected_quantity")),d=f.$component_options_select.find("option:selected").data("title"),e=b>1?wc_composite_params.i18n_qty_string.replace("%s",b):"",g=wc_composite_params.i18n_title_string.replace("%t",d).replace("%q",e).replace("%p",""),h=f.$component_summary_content.find(".composited_product_title");h.html(g)},init_dependencies:function(){f.init_scripts()},block:function(){f.has_options_style("thumbnails")?c.block(f.$component_options.find(".component_option_thumbnails .selected")):c.block(f.$component_options)},unblock:function(){f.has_options_style("thumbnails")?c.unblock(f.$component_options.find(".component_option_thumbnails .selected")):c.unblock(f.$component_options)},option_changed:function(b){var c=b.data.view,d=a(this).val();if(a(this).blur(),f.get_selected_product(!1)===d)return!1;if(f.has_options_style("thumbnails"))f.$component_options.find(".component_option_thumbnails .selected").removeClass("selected disabled"),f.$component_options.find("#component_option_thumbnail_"+d).addClass("selected");else if(f.has_options_style("radios")){var e=f.$component_options.find(".component_option_radio_buttons .selected");e.removeClass("selected disabled"),e.find("input").prop("checked",!1),f.$component_options.find("#component_option_radio_button_"+(""===d?"0":d)).addClass("selected").find("input").prop("checked",!0)}return f.$component_summary_content.removeClass("variations_form bundle_form cart"),f.$component_summary_content.off().find("*").off(),""!==d?(c.block(),f.$component_content.addClass("updating"),setTimeout(function(){c.model.request_details(d)},120)):(c.model.selected_product="",c.render_response(!1)),!1},render_response:function(b){var d=this,e=this.model.selected_product,g=this.relocations_allowed();if("undefined"!=typeof f.$component_content.get(0).getBoundingClientRect().height?d.load_height=f.$component_content.get(0).getBoundingClientRect().height:d.load_height=f.$component_content.outerHeight(),d.relocate_component_content=!1,d.relocate_to_origin=!1,d.$relocation_target=!1,d.$relocation_reference=!1,g&&!1===d.$relocation_origin&&(d.$relocation_origin=a('<div class="component_content_origin">'),f.$component_content.before(d.$relocation_origin)),g){var h=d.get_content_relocation_params();d.$relocation_reference=h.reference,d.relocate_component_content=h.relocate}else d.is_relocated()&&(d.relocate_component_content=!0,d.relocate_to_origin=!0);if(""!==e)if(d.relocate_component_content)if(d.relocate_to_origin)f.$component_content.animate({height:0},{duration:200,queue:!1,always:function(){d.reset_relocated_content(),d.update_content(b.markup)}}),d.load_height=0;else{var i=f.$component_content.wc_cp_is_in_viewport();d.relocated=!0,f.$component_content.addClass("relocated"),f.$component_content.addClass("relocating"),d.$relocation_target=a('<li class="component_option_content_container">'),d.$relocation_reference.after(d.$relocation_target),f.$component_content.animate({height:0},{duration:200,queue:!1,always:function(){d.update_content(b.markup)}}),f.$component_content.offset().top<d.$relocation_target.offset().top&&!i&&wc_cp_scroll_viewport("relative",{offset:d.load_height,timeout:0,duration:200,queue:!1}),d.load_height=0}else f.$component_content.css("height",d.load_height),d.update_content(b.markup);else{var j=!0;if(d.resetting_product&&(j=!1),j){f.$component_data.data("product_type","none");var k=c.$composite_navigation_movable.is(":visible")?c.$composite_navigation_movable.outerHeight(!0):0,l=d.is_relocated()?0:f.$component_summary.outerHeight(!0)-f.$component_summary_content.innerHeight()-k;f.$component_content.animate({height:l},{duration:200,queue:!1,always:function(){d.reset_content(),f.$component_content.css({height:"auto"})}})}else d.reset_content()}},update_content:function(a){var b=this;f.$component_summary_content.html(a),b.relocate_component_content&&(f.$component_content.appendTo(b.$relocation_target),f.$component_options.find(".component_option_content_container").not(b.$relocation_target).remove()),b.updated_content();var c=300;setTimeout(function(){b.animate_updated_content()},c)},updated_content:function(){this.model.selected_product>0?f.init_scripts():f.init_scripts(!1),this.model.update_selected_product(),f.component_options_model.refresh_options_state(f)},animate_updated_content:function(){var a=f.$component_summary.outerHeight(!0),b=!1,d=this;this.relocate_component_content||Math.abs(a-this.load_height)>1?b=!0:f.$component_content.css("height","auto"),this.is_relocated()&&f.$component_content.removeClass("relocating"),b?(c.console_log("debug:events","Starting updated content animation..."),f.$component_content.animate({height:a},{duration:200,queue:!1,always:function(){c.console_log("debug:events","Ended updated content animation."),wc_cp_scroll_viewport(f.$component_content,{offset:50,partial:"paged"!==c.settings.layout,scroll_method:"middle",duration:200,queue:!1,always_on_complete:!0,on_complete:function(){f.$component_content.css({height:"auto"}),d.unblock(),f.$component_content.removeClass("updating")}})}})):wc_cp_scroll_viewport(f.$component_content,{offset:50,partial:"paged"!==c.settings.layout,scroll_method:"middle",duration:200,queue:!1,always_on_complete:!0,on_complete:function(){d.unblock(),f.$component_content.removeClass("updating")}})},reset_content:function(){f.$component_summary_content.html('<div class="component_data" data-price="0" data-regular_price="0" data-product_type="none" style="display:none;"></div>'),f.$el.find(".composite_navigation.movable").length>0&&c.$composite_navigation_movable.addClass("hidden"),this.reset_relocated_content(),this.updated_content()},component_options_flush_handler:function(a,b){this.is_relocated()&&"reload"===b&&"success"===a.result&&(this.flushing_component_options=!0,this.reset_relocated_content(),this.flushing_component_options=!1)},reset_relocated_content:function(){this.is_relocated()&&(f.$component_message.hide(),this.flushing_component_options&&f.$component_content.hide(),f.component_selection_view.$relocation_origin.after(f.$component_content),this.flushing_component_options&&setTimeout(function(){f.$component_content.slideDown(250),wc_cp_scroll_viewport("relative",{offset:-f.$component_summary.outerHeight(!0),timeout:0,duration:250,queue:!1})},200),f.component_selection_view.$relocation_origin.remove(),f.component_selection_view.$relocation_origin=!1,f.$component_options.find(".component_option_content_container").remove(),!1===this.flushing_component_options&&""===this.model.selected_product&&wc_cp_scroll_viewport(f.$component_selections,{partial:!1,duration:250,queue:!1}),this.relocated=!1,f.$component_content.removeClass("relocated"))},relocations_allowed:function(){return"paged"===c.settings.layout&&f.append_results()&&f.has_options_style("thumbnails")&&!f.$el.hasClass("disable-relocations")&&f.$component_options.height()>$wc_cp_window.height()?!0:!1},is_relocated:function(){return this.relocated},get_content_relocation_params:function(){var a=!1,b=!1,c=f.$component_options.find(".component_option_thumbnail.selected").closest(".component_option_thumbnail_container"),d=c.outerWidth(!0)/f.$component_options.outerWidth(),e=c.hasClass("last")||d>.6?c:c.nextAll(".last").first();return b=e.length>0?e:f.$component_options.find(".component_option_thumbnail_container").last(),0===b.next(".component_option_content_container").length&&(a=!0),{reference:b,relocate:a}}}),h=new g(e);return h},this.Component_Title_View=function(d,e){var f=d,g=b.View.extend({initialize:function(){this.$el.on("click",this.clicked_title_handler),"progressive"===c.settings.layout&&f.has_toggle()&&(this.listenTo(f.step_access_model,"change:is_locked",this.render_navigation_state),c.actions.add_action("active_step_changed",this.active_step_changed_handler,100,this))},clicked_title_handler:function(){return a(this).blur(),f.has_toggle()?f.is_current()?!1:a(this).hasClass("inactive")?!1:("single"===c.settings.layout?wc_cp_toggle_element(f.$el,f.$component_inner):c.navigate_to_step(f),!1):!1},active_step_changed_handler:function(){this.render_navigation_state()},render_navigation_state:function(){"progressive"===c.settings.layout&&f.has_toggle()&&(c.console_log("debug:views",'\nUpdating "'+f.get_title()+'" component title state...'),f.is_current()?this.$el.removeClass("inactive"):f.is_locked()?this.$el.addClass("inactive"):this.$el.removeClass("inactive"))}}),h=new g(e);return h}},d.WC_CP_Actions_Dispatcher=function(b){var c=this,d={},e={add_action:function(a,b,c,e){var f={callback:b,priority:c,context:e},g=d[a];g?(g.push(f),g=this.sort_actions(g)):g=[f],d[a]=g},remove_action:function(a,b,c){var e,f,g;if(d[a])if(b)if(e=d[a],c)for(g=e.length;g--;)f=e[g],f.callback===b&&f.context===c&&e.splice(g,1);else for(g=e.length;g--;)e[g].callback===b&&e.splice(g,1);else d[a]=[]},sort_actions:function(a){for(var b,c,d,e=1,f=a.length;f>e;e++){for(b=a[e],c=e;(d=a[c-1])&&d.priority>b.priority;)a[c]=a[c-1],--c;a[c]=b}return a},do_action:function(a,b){var c,e,f=d[a];if(!f)return!1;for(e=f.length,c=0;e>c;c++)f[c].callback.apply(f[c].context,b);return!0}};this.init=function(){b.console_log("debug:events","\nInitializing Actions Dispatcher..."),a.each(b.get_steps(),function(a,d){d.is_component()&&(d.component_selection_model.on("change:selected_product change:selected_variation",function(){
d.initializing_scripts||c.do_action("component_selection_changed",[d])}),d.component_selection_model.on("change:selected_quantity",function(){c.do_action("component_quantity_changed",[d])}),d.component_selection_model.on("change:selected_addons",function(){d.initializing_scripts||c.do_action("component_addons_changed",[d])}),d.component_selection_model.on("change:selected_nyp",function(){d.initializing_scripts||c.do_action("component_nyp_changed",[d])}),d.component_options_model.on("change:active_options",function(){c.do_action("active_options_changed",[d])}),d.component_options_model.on("change:available_options",function(){c.do_action("available_options_changed",[d])}),b.data_model.on("change:component_"+d.step_id+"_totals",function(){c.do_action("component_totals_changed",[d])}),d.$el.on("woocommerce-composited-product-update",function(){d.initializing_scripts||c.do_action("component_selection_changed",[d])})),d.step_validation_model.on("change:composite_messages",function(){d.initializing_scripts||c.do_action("component_validation_message_changed",[d])})}),c.add_action("show_step",function(a){c.do_action("show_step_"+a.step_id)},0,this),c.add_action("active_step_changed",function(a){c.do_action("active_step_changed_"+a.step_id)},0,this),c.add_action("active_step_transition_start",function(a){c.do_action("active_step_transition_start_"+a.step_id)},0,this),c.add_action("active_step_transition_end",function(a){c.do_action("active_step_transition_end_"+a.step_id)},0,this),c.add_action("active_options_changed",function(a){c.do_action("active_options_changed_"+a.step_id)},0,this),c.add_action("available_options_changed",function(a){c.do_action("available_options_changed_"+a.step_id)},0,this),c.add_action("component_options_loaded",function(a){c.do_action("component_options_loaded_"+a.step_id),a.$el.trigger("wc-composite-component-options-loaded",[a,b])},0,this),c.add_action("component_scripts_initialized",function(a){c.do_action("component_scripts_initialized_"+a.step_id),a.$el.trigger("wc-composite-component-loaded",[a,b])},0,this),b.scenarios.on("active_scenarios_changed",function(a){c.do_action("active_scenarios_changed",[a])}),b.scenarios.on("active_scenarios_updated",function(a){c.do_action("active_scenarios_updated",[a])}),b.data_model.on("change:totals",function(){c.do_action("composite_totals_changed")}),b.data_model.on("change:passes_validation",function(){c.do_action("composite_validation_status_changed")}),b.data_model.on("change:validation_messages",function(){c.do_action("composite_validation_message_changed")}),b.data_model.on("change:is_in_stock",function(){c.do_action("composite_availability_status_changed")}),b.data_model.on("change:stock_statuses",function(){c.do_action("composite_availability_message_changed")})},this.add_action=function(a,b,d,f){return"string"==typeof a&&"function"==typeof b&&(d=parseInt(d||10,10),e.add_action(a,b,d,f)),c},this.do_action=function(a,b){return"string"==typeof a&&e.do_action(a,b),c},this.remove_action=function(a,b){return"string"==typeof a&&e.remove_action(a,b),c}},d.WC_CP_Filters_Manager=function(){var a=this,b={},c={add_filter:function(a,c,d,e){var f={callback:c,priority:d,context:e},g=b[a];g?(g.push(f),g=this.sort_filters(g)):g=[f],b[a]=g},remove_filter:function(a,c,d){var e,f,g;if(b[a])if(c)if(e=b[a],d)for(g=e.length;g--;)f=e[g],f.callback===c&&f.context===d&&e.splice(g,1);else for(g=e.length;g--;)e[g].callback===c&&e.splice(g,1);else b[a]=[]},sort_filters:function(a){for(var b,c,d,e=1,f=a.length;f>e;e++){for(b=a[e],c=e;(d=a[c-1])&&d.priority>b.priority;)a[c]=a[c-1],--c;a[c]=b}return a},apply_filters:function(a,c){var d,e,f=b[a];if(!f)return c[0];for(e=f.length,d=0;e>d;d++)c[0]=f[d].callback.apply(f[d].context,c);return c[0]}};this.add_filter=function(b,d,e,f){return"string"==typeof b&&"function"==typeof d&&(e=parseInt(e||10,10),c.add_filter(b,d,e,f)),a},this.apply_filters=function(a,b){return"string"==typeof a?c.apply_filters(a,b):void 0},this.remove_filter=function(b,d){return"string"==typeof b&&c.remove_filter(b,d),a}},d.WC_CP_Scenarios_Manager=function(c){var d=this,e={updating_scenarios:!1,scenario_data:c.$composite_data.data("scenario_data"),active_scenarios:[],invalid_product_step_indexes:[],invalid_variation_step_indexes:[]};_.extend(d,b.Events),this.init=function(){c.actions.add_action("available_options_changed",this.available_options_changed_handler,-10,this),c.actions.add_action("component_selection_changed",this.selection_changed_handler,10,this),c.console_log("debug:events","\nInitializing Scenarios Manager..."),c.debug_tab_count=c.debug_tab_count+2,d.update_active_scenarios(_.first(c.steps),!1,!1),c.debug_tab_count=c.debug_tab_count-2,c.console_log("debug:events","\nScenarios Manager initialized.\n")},this.has_invalid_product=function(a){return _.contains(e.invalid_product_step_indexes,a)},this.has_invalid_variation=function(a){return _.contains(e.invalid_variation_step_indexes,a)},this.get_active_scenarios=function(){return e.active_scenarios},this.get_invalid_step_indexes=function(){return _.sortBy(_.uniq(_.union(e.invalid_product_step_indexes,e.invalid_variation_step_indexes)),function(a){return a})},this.get_scenario_data=function(){return e.scenario_data},this.set_component_scenario_data=function(a,b){e.scenario_data.scenario_data[a]=b},this.set_component_scenario_data=function(a,b){e.scenario_data.scenario_data[a]=b},this.selection_changed_handler=function(a){this.update_active_scenarios(a)},this.available_options_changed_handler=function(a){this.update_active_scenarios(a)},this.update_active_scenarios=function(a){if(c.console_log("debug:scenarios",'\nScenarios update triggered by event originating from "'+a.get_title()+'"...'),a.initializing_scripts)return c.console_log("debug:scenarios","Breaking out - event triggered during script init...\n\n"),!1;c.console_log("debug:scenarios","\nClearing incompatible products/variations data..."),e.invalid_product_step_indexes=[],e.invalid_variation_step_indexes=[];var b=e.active_scenarios;e.updating_scenarios=!0;var f=this.calculate_active_scenarios(a,!1,!1);e.updating_scenarios=!1,b.length!==f.length||b.length!==_.intersection(b,f).length?(c.console_log("debug:scenarios","\nActive scenarios changed: - ["+b+"] => ["+f+"]"),e.active_scenarios=f,d.trigger("active_scenarios_changed",a)):c.console_log("debug:scenarios","\nActive scenarios unchanged."),d.trigger("active_scenarios_updated",a)},this.calculate_active_scenarios=function(b,f,g){var h=b.step_index,i=d.get_scenario_data().scenarios,j=d.filter_scenarios_by_type(i,"compat_group");b.is_review()&&(h=1e3),0===j.length&&i.push("0");var k=i,l=[];e.updating_scenarios||c.console_log("debug:scenarios",'\nScenarios requested by "'+b.get_title()+'"...'),c.console_log("debug:scenarios","\nCalculating active scenarios..."),a.each(c.get_components(),function(a,b){if(g&&parseInt(b.step_index)===parseInt(h))return!0;if(f&&b.step_index>h)return!1;var i=b.get_selected_product(!1),j=b.get_selected_product_type();if(null!==i&&i>=0){var m=d.get_scenario_data().scenario_data,n=m[b.component_id];if(""===i){if(!(0 in n))return!0;i="0"}var o=n[i];c.console_log("debug:scenarios","Selection #"+i+' of "'+b.get_title()+'" in scenarios: ['+o+"]");var p=_.intersection(k,o),q=p.length>0,r="",s=!0;if(q&&"variable"===j&&(r=b.get_selected_variation(!1),r>0)){var t=n[r];c.console_log("debug:scenarios","Variation selection #"+r+' of "'+b.get_title()+'" in scenarios: ['+t+"]"),p=_.intersection(p,t),s=p.length>0}var u=q&&s;if(u)l.push(b.component_id),k=p,c.console_log("debug:scenarios","Active scenarios: ["+k+"]");else if(q){if(!s){var v="Incompatible variation selection found...";e.updating_scenarios&&r>0&&(v+=" saved.",e.invalid_variation_step_indexes.push(b.step_index)),c.console_log("debug:scenarios",v)}}else{var w="Incompatible product selection found...";e.updating_scenarios&&i>0&&(w+=" saved.",e.invalid_product_step_indexes.push(b.step_index)),c.console_log("debug:scenarios",w)}}}),c.console_log("debug:scenarios","Removing active scenarios where all scenario shaping components ("+l+") are masked...");var m=d.get_binding_scenarios(k,l);return c.console_log("debug:scenarios","Calculated active scenarios: ["+m+"]\n"),m},this.get_binding_scenarios=function(b,c){var d=this.get_scenario_data().scenario_settings.masked_components,e=[];if(c.length>0){if(b.length>0)for(var f=0;f<b.length;f++){for(var g=b[f],h=!0,i=0;i<c.length;i++){var j=c[i];if(-1==a.inArray(j.toString(),d[g])){h=!1;break}}h||e.push(g)}}else e=b;return 0===e.length&&b.length>0&&(e=b),e},this.get_active_scenarios_by_type=function(a){return this.filter_scenarios_by_type(e.active_scenarios,a)},this.get_scenarios_by_type=function(a){return this.filter_scenarios_by_type(this.get_scenario_data().scenarios,a)},this.filter_scenarios_by_type=function(b,c){var d=[],e="";if(b.length>0)for(var f=0;f<b.length;f++)e=b[f],a.inArray(c,this.get_scenario_data().scenario_settings.scenario_actions[e])>-1&&d.push(e);return d},this.get_binding_scenarios_for=function(b,c){var d=this.get_scenario_data().scenario_settings.masked_components,e=[],f="";if(b.length>0)for(var g=0;g<b.length;g++)f=b[g],-1==a.inArray(c.toString(),d[f])&&e.push(f);return e}},d.WC_CP_Step_Factory=function(){function b(b,c,d){var e=this;this.step_id=c.data("item_id"),this.step_index=d,this.step_title=c.data("nav_title"),this.step_slug=b.$composite_data.data("composite_settings").slugs[this.step_id],this._component_messages=[],this._composite_messages=[],this._is_component=c.hasClass("component"),this._is_review=c.hasClass("cart"),this._is_current=c.hasClass("active"),this._is_previous=c.hasClass("prev"),this._is_next=c.hasClass("next"),this._toggled=c.hasClass("toggled"),this._autotransition=c.hasClass("autotransition"),this.$el=c,this.$inner_el=c.find(".component_inner"),this.$step_title=c.find(".component_title"),this.$self=c,this.add_actions=function(){"single"===b.settings.layout?b.actions.add_action("show_step_"+e.step_id,this.autoscroll_single,10,this):"paged"===b.settings.layout?(b.actions.add_action("active_step_changed",this.autoscroll_paged,120,this),b.actions.add_action("active_step_transition_end_"+e.step_id,this.autoscroll_paged_relocated,10,this)):"progressive"===b.settings.layout&&b.actions.add_action("active_step_transition_end_"+e.step_id,this.autoscroll_progressive,10,this)},this.autoscroll_single=function(){var a=b.is_initialized===!1?!1:!0;a&&wc_cp_scroll_viewport(e.$el,{partial:!1,duration:250,queue:!1})},this.autoscroll_paged=function(a){if(e.step_id===a.step_id){var c=b.is_initialized===!1?!1:!0,d=e.is_component(),f=d?e:!1;d&&f.component_selection_view.is_relocated()||c&&wc_cp_scroll_viewport(b.$composite_form.find(".scroll_show_component"),{timeout:20,partial:!0,duration:250,queue:!1})}},this.autoscroll_paged_relocated=function(){var a=b.is_initialized===!1?!1:!0,c=e.is_component(),d=c?e:!1;c&&d.component_selection_view.is_relocated()&&a&&wc_cp_scroll_viewport(d.$component_content,{timeout:0,partial:!1,duration:250,queue:!1,scroll_method:"middle"})},this.autoscroll_progressive=function(){var a=b.is_initialized===!1?!1:!0;a&&e.$el.hasClass("autoscrolled")&&(e.$step_title.wc_cp_is_in_viewport(!1)||wc_cp_scroll_viewport(e.$el,{timeout:0,partial:!1,duration:250,queue:!1}))},this.autotransition=function(){return this._autotransition},this.is_animating=function(){return this.$el.hasClass("animating")},this.has_toggle=function(){return this._toggled},this.is_locked=function(){var a=this.step_access_model.get("is_locked");return b.filters.apply_filters("step_is_locked",[a,this])},this.lock=function(){this.step_access_model.set({locked:!0})},this.unlock=function(){this.step_access_model.set({locked:!1})},this.get_title=function(){return this.step_title},this.get_element=function(){return this.$el},this.is_review=function(){return this._is_review},this.is_component=function(){return this._is_component},this.get_component=function(){return this._is_component?this:!1},this.is_current=function(){return this._is_current},this.is_next=function(){return this._is_next},this.is_previous=function(){return this._is_previous},this.show_step=function(){if(this.is_locked()||this.is_animating())return!1;var a=this.is_current();"single"===b.settings.layout&&this.toggle_step("open",!0),a&&b.is_initialized||this.set_active(),b.actions.do_action("show_step",[this])},this.set_active=function(){var c=this,d=b.settings.layout,e=b.settings.layout_variation,f=b.get_current_step(),g=b.get_next_step(),h=b.get_previous_step(),i=b.get_step_by("index",c.step_index+1),j=b.get_step_by("index",c.step_index-1);if("paged"===d&&"componentized"===e&&(i=j=b.get_step_by("id","review")),f._is_current=!1,c._is_current=!0,f.$el.removeClass("active"),this.$el.addClass("active"),!1!==g&&(g._is_next=!1,g.$el.removeClass("next")),!1!==i&&(i._is_next=!0,i.$el.addClass("next")),!1!==h&&(h._is_previous=!1,h.$el.removeClass("prev")),!1!==j&&(j._is_previous=!0,j.$el.addClass("prev")),f.step_id!==c.step_id)if("paged"===d){b.has_transition_lock=!0;var k=f.$el.clone(),l="slide"===wc_composite_params.transition_type?10:250;f.$el.find("select").each(function(){if(!a(this).is(":visible"))return!0;var b=a(this).attr("name");k.find('select[name="'+b+'"]').val(a(this).val())}),f.$el.find("textarea").each(function(){if(!a(this).is(":visible"))return!0;var b=a(this).attr("name");k.find('textarea[name="'+b+'"]').val(a(this).val())}),k.find("select, input, textarea").each(function(){a(this).attr("name",a(this).attr("name")+"_cloned")}),k.insertBefore(f.$el.hide()),setTimeout(function(){k.addClass("faded"),"fade"===wc_composite_params.transition_type&&c.$el.addClass("invisible faded"),setTimeout(function(){var a=150;if("slide"===wc_composite_params.transition_type){var d=k.height(),e=c.$el.height(),g=.3*d+.7*e;a=150+Math.min(450,parseInt(g/5))}b.actions.do_action("active_step_transition_start",[c]),b.console_log("debug:events","Starting transition..."),k.slideUp({duration:a,always:function(){k.remove()}}),f.step_index<c.step_index&&(c.$el.after('<div style="display:none" class="active_placeholder"></div>'),c.$el.insertBefore(k)),c.$el.slideDown({duration:a,always:function(){f.step_index<c.step_index&&b.$composite_form.find(".active_placeholder").replaceWith(c.$el),setTimeout(function(){b.actions.do_action("active_step_transition_end",[c])},l),b.console_log("debug:events","Transition ended."),"fade"===wc_composite_params.transition_type&&setTimeout(function(){b.$steps.removeClass("faded invisible")},10),b.has_transition_lock=!1}})},l)},10)}else"progressive"===d&&c.update_block_state(),b.has_transition_lock=!0,setTimeout(function(){b.actions.do_action("active_step_transition_start",[c])},5),setTimeout(function(){b.actions.do_action("active_step_transition_end",[c]),b.has_transition_lock=!1},350);else c.$el.show();b.actions.do_action("active_step_changed",[this])},this.update_block_state=function(){var c=b.settings.layout;return"progressive"!==c?!1:(a.each(b.get_steps(),function(a,b){b.step_index<e.step_index&&(b.block_step_inputs(),b.$el.hasClass("block-open")||b.toggle_step("closed",!0))}),this.unblock_step_inputs(),this.unblock_step(),void this.block_next_steps())},this.unblock_step=function(){this.toggle_step("open",!0),this.$el.removeClass("blocked")},this.block_next_steps=function(){var c=this.step_index;a.each(b.get_steps(),function(a,b){a>c&&(b.$el.hasClass("disabled")&&b.unblock_step_inputs(),b.block_step())})},this.block_step=function(){this.$el.addClass("blocked"),this.toggle_step("closed",!1)},this.toggle_step=function(a,b,c){this.has_toggle()&&("open"===a?this.$el.hasClass("closed")&&wc_cp_toggle_element(this.$el,this.$inner_el,c):"closed"===a&&this.$el.hasClass("open")&&wc_cp_toggle_element(this.$el,this.$inner_el,c),b?this.$step_title.removeClass("inactive"):this.$step_title.addClass("inactive"))},this.unblock_step_inputs=function(){this.$el.removeClass("disabled");var a=this.$el.find(".clear_component_options");a.html(wc_composite_params.i18n_clear_selection).removeClass("reset_component_options")},this.block_step_inputs=function(){if(this.$el.addClass("disabled"),!e.has_toggle()||e.$el.hasClass("block-open")){var a=this.$el.find(".clear_component_options");a.html(wc_composite_params.i18n_reset_selection).addClass("reset_component_options")}},this.is_blocked=function(){return this.$el.hasClass("blocked")},this.has_blocked_inputs=function(){return this.$el.hasClass("disabled")},this.add_validation_message=function(a,b){b="undefined"==typeof b?"component":b,"composite"===b?this._composite_messages.push(a.toString()):this._component_messages.push(a.toString())},this.get_validation_messages=function(a){var c;return a="undefined"==typeof a?"component":a,c="composite"===a?this._composite_messages:this._component_messages,b.filters.apply_filters("step_validation_messages",[c,a,this])},this.validate=function(){if(e.initializing_scripts)return!1;var a=this,c=!0,d=!0;if(this._component_messages=[],this._composite_messages=[],this.is_component()){var f=this.get_selected_product(),g=this.get_selected_variation(),h=this.get_selected_product_type();c=!1,f>0?"variable"===h&&g>0?c=!0:"simple"===h||"none"===h?c=!0:"variable"!==h&&"simple"!==h&&this.$component_data.data("component_set")===!0&&(c=!0):""===f&&this.is_optional()&&(c=!0),c=b.filters.apply_filters("step_is_valid",[c,this]),c||(f>0?"invalid-product"===h?this.add_validation_message(wc_composite_params.i18n_item_unavailable_text,"composite"):"variable"===h&&(this.is_selected_variation_valid()?(this.add_validation_message(wc_composite_params.i18n_select_product_options),this.add_validation_message(wc_composite_params.i18n_select_product_options_for,"composite")):this.add_validation_message(wc_composite_params.i18n_selected_product_options_invalid,"composite")):this.is_selected_product_valid()?(this.add_validation_message(wc_composite_params.i18n_select_component_option),this.add_validation_message(wc_composite_params.i18n_select_component_option_for,"composite")):this.add_validation_message(wc_composite_params.i18n_selected_product_invalid,"composite")),this.is_in_stock()||(d=!1),b.actions.do_action("validate_step",[a,c])}this.step_validation_model.update(c,d)},this.passes_validation=function(){return this.step_validation_model.get("passes_validation")},this.add_actions()}function c(c,d,e){b.call(this,c,d,e);var f=this;this.initializing_scripts=!1,this.component_index=e,this.component_id=d.attr("data-item_id"),this.component_title=d.data("nav_title"),this.has_compat_results=!0,this.compat_results_count=0,this._hide_disabled_products=d.hasClass("hide-incompatible-products"),this._hide_disabled_variations=d.hasClass("hide-incompatible-variations"),this._append_results=d.hasClass("append-results"),this._is_static=d.hasClass("static"),this.$component_summary=d.find(".component_summary"),this.$component_summary_content=d.find(".component_summary > .content"),this.$component_selections=d.find(".component_selections"),this.$component_content=d.find(".component_content"),this.$component_options=d.find(".component_options"),this.$component_filters=d.find(".component_filters"),this.$component_ordering=d.find(".component_ordering select"),this.$component_options_inner=d.find(".component_options_inner"),this.$component_inner=d.find(".component_inner"),this.$component_pagination=d.find(".component_pagination"),this.$component_message=d.find(".component_message"),this.$component_message_content=d.find(".component_message ul.msg"),this.$component_data=this.$component_summary_content.find(".component_data"),this.$component_quantity=this.$component_summary_content.find(".component_wrap input.qty"),this.$component_options_select=this.$component_options.find("select.component_options_select"),this.add_component_actions=function(){"single"!==c.settings.layout&&c.actions.add_action("active_step_transition_start_"+f.step_id,this.autoload_compat_options,10,this)},this.autoload_compat_options=function(){if("yes"===wc_composite_params.compat_options_autoload&&"single"!==c.settings.layout&&f.has_options_style("thumbnails")&&f.append_results()&&f.hide_disabled_products()){var a=f.$component_pagination.find(".component_options_load_more"),b=f.find_pagination_param("results_per_page");(!1===f.has_compat_results||f.compat_results_count<b)&&a.trigger("click")}},this.append_results=function(){return this._append_results},this.get_selected_product=function(a){return"undefined"==typeof a&&(a=!0),a&&!this.is_selected_product_valid()?null:this.component_selection_model.get("selected_product")},this.get_selected_variation=function(a){return"undefined"==typeof a&&(a=!0),a&&!this.is_selected_variation_valid()?null:this.component_selection_model.get("selected_variation")},this.get_selected_quantity=function(){return this.component_selection_model.get("selected_quantity")},this.get_selected_product_type=function(){return this.$component_data.data("product_type")},this.get_selected_product_title=function(a,b){if(b="undefined"==typeof b?!1:b,a="undefined"==typeof a?!1:a,b&&!this.is_selected_product_valid())return"";var d=this.component_selection_model.selected_product_title,e=this.get_selected_quantity(),f=this.get_selected_product_type(),g="",h="",i="";return d=c.filters.apply_filters("component_selection_title",[d,this]),d&&a&&("none"===f?this.is_optional()&&(g='<span class="content_product_title none">'+d+"</span>"):(i=e>1?"<strong>"+wc_composite_params.i18n_qty_string.replace("%s",e)+"</strong>":"",g=wc_composite_params.i18n_title_string.replace("%t",d).replace("%q",i).replace("%p",""),h=this.get_selected_product_meta(!0),h&&(g=wc_composite_params.i18n_selected_product_string.replace("%t",g).replace("%m",'<span class="content_product_meta">'+h+"</span>")),g='<span class="content_product_title">'+g+"</span>"),g=c.filters.apply_filters("component_selection_formatted_title",[g,d,e,h,this])),a?g:d},this.get_selected_product_meta=function(b){b="undefined"==typeof b?!1:b;var d="",e=this.get_selected_variation(!1)>0?this.component_selection_model.selected_variation_data:[];return e=c.filters.apply_filters("component_selection_meta",[e,this]),e.length>0&&b&&(a.each(e,function(a,b){d=d+'<span class="meta_element"><span class="meta_key">'+b.meta_key+':</span> <span class="meta_value">'+b.meta_value,a!==e.length-1&&(d+=", "),d+="</span></span>"}),d=c.filters.apply_filters("component_selection_formatted_meta",[d,e,this])),b?d:e},this.get_selected_product_image_src=function(a){return a="undefined"==typeof a?!0:a,a&&!this.is_selected_product_valid()?"":this.get_selected_variation(a)>0&&this.component_selection_model.selected_variation_image_src?this.component_selection_model.selected_variation_image_src:this.component_selection_model.selected_product_image_src},this.is_selected_product_valid=function(a){return"undefined"==typeof a&&(a=this.component_options_model.get("active_options")),""===this.component_selection_model.get("selected_product")||_.contains(a,this.component_selection_model.get("selected_product"))},this.is_selected_variation_valid=function(a){return"undefined"==typeof a&&(a=this.component_options_model.get("active_options")),""===this.component_selection_model.get("selected_variation")||_.contains(a,this.component_selection_model.get("selected_variation"))},this.hide_disabled_products=function(){return this._hide_disabled_products},this.hide_disabled_variations=function(){return this._hide_disabled_variations},this.find_selected_product_param=function(b){if("id"===b)return this.$component_options_select.val();if("variation_id"===b)return"variable"===this.get_selected_product_type()?this.$component_summary_content.find(".single_variation_wrap .variations_button input.variation_id").val():"";if("title"===b)return this.$component_options_select.find("option:selected").data("title");if("variation_data"===b){var c=this.$component_summary_content.find(".variations");return c.length>0?wc_cp_get_variation_data(c,!1):[]}if("product_image_src"===b){var d=this.$component_options_select.find("option:selected").data("image_src");return d?d:""}if("variation_image_src"===b){var e=this.find_selected_product_param("variation_id"),f=this.$component_data.data("product_variations"),g="";return e>0&&f&&a.each(f,function(a,b){return parseInt(b.variation_id)===parseInt(e)?(g=b.image_src,!1):void 0}),g?g:""}if("quantity"===b){var h=this.$component_quantity.length>0?this.$component_quantity.val():0;return parseInt(h)}if("addons_price"===b){var i=this.$component_summary_content.find(".component_wrap #product-addons-total"),j=i.length>0?i.data("addons-raw-price"):0;return Number(j)}if("nyp_price"===b){var k=this.$component_summary_content.find(".nyp"),l=k.length>0?k.data("price"):0;return Number(l)}},this.find_pagination_param=function(a,b){"undefined"==typeof b&&(b=f.$component_pagination);var c=1;return b.length>0?"current_page"===a?c=b.find(".pagination_data").data("page_num"):"pages"===a?c=b.find(".pagination_data").data("pages"):"results_per_page"===a&&(c=b.find(".pagination_data").data("results_per_page")):"results_per_page"===a&&(c=""),c},this.find_order_by=function(){var a="";return this.$component_ordering.length>0&&(a=this.$component_ordering.val()),a},this.find_active_filters=function(){var b=this.$component_filters,c={};return 0==b.length?c:(b.find(".component_filter_option.selected").each(function(){var b=a(this).closest(".component_filter").data("filter_type"),d=a(this).closest(".component_filter").data("filter_id"),e=a(this).data("option_id");b in c?d in c[b]?c[b][d].push(e):(c[b][d]=[],c[b][d].push(e)):(c[b]={},c[b][d]=[],c[b][d].push(e))}),c)},this.find_available_options=function(){var b=f.$component_options_select.find("option"),c=[];return b.length>0&&b.each(function(){c.push(a(this).val())}),c},this.is_in_stock=function(){var a=!0;return this.$component_summary_content.find(".component_wrap .out-of-stock").not(".inactive").length>0&&this.get_selected_quantity()>0&&("variable"!==this.get_selected_product_type()||this.get_selected_variation(!1)>0)&&(a=!1),a},this.is_nyp=function(){return this.component_selection_model.get("selected_nyp")>0},this.has_options_style=function(a){return this.$el.hasClass("options-style-"+a)},this.get_bundle_script=function(){var a=!1;return"undefined"!=typeof wc_pb_bundle_scripts[f.component_id]&&(a=wc_pb_bundle_scripts[f.component_id]),a},this.init_scripts=function(b){if("undefined"==typeof b&&(b=!0),this.$component_data=this.$component_summary_content.find(".component_data"),this.$component_quantity=this.$component_summary_content.find(".component_wrap input.qty"),b){f.initializing_scripts=!0,f.init_qty_input();var d=this.get_selected_product_type(),e=this.$component_summary_content;"variable"===d?(e.hasClass("cart")||e.addClass("cart"),e.hasClass("variations_form")||e.addClass("variations_form"),e.data("product_variations",this.$component_data.data("product_variations")),a.each(this.$component_data.data("product_variations"),function(a,b){f.component_options_model.attributes.active_options.push(b.variation_id.toString())}),e.wc_variation_form(),e.find(".variations select").change(),e.find("div").stop(!0,!0)):"bundle"===d?(e.hasClass("bundle_form")||e.addClass("bundle_form"),e.find(".bundle_data").wc_pb_bundle_form(),e.find("div").stop(!0,!0)):e.hasClass("cart")||e.addClass("cart"),f.initializing_scripts=!1}c.actions.do_action("component_scripts_initialized",[f])},this.get_step=function(){return c.get_step(this.component_id)},this.is_static=function(){return this._is_static},this.is_optional=function(){var a=_.contains(this.component_options_model.get("active_options"),"");return c.filters.apply_filters("component_is_optional",[a,this])},this.init_qty_input=function(){("no"===wc_composite_params.is_wc_version_gte_2_3||"yes"===wc_composite_params.show_quantity_buttons)&&this.$component_summary_content.find("div.quantity:not(.buttons_added), td.quantity:not(.buttons_added)").addClass("buttons_added").append('<input type="button" value="+" class="plus" />').prepend('<input type="button" value="-" class="minus" />'),this.$component_quantity.trigger("change")},this.get_selected_product_id=function(){return this.find_selected_product_param("id")},this.add_component_actions()}this.create_component=function(a,d,e){return c.prototype=this.create(b.prototype),c.prototype.constructor=c,new c(a,d,e)},this.create_step=function(a,c,d){return c.hasClass("component")?this.create_component(a,c,d):new b(a,c,d)},this.create=function(a){function b(){}return b.prototype=a,new b}},$wc_cp_document.ready(function(){$wc_cp_body.on("quick-view-displayed",function(){a(".composite_form .composite_data").each(function(){a(this).wc_composite_form()})}),$wc_cp_window.resize(function(){a.each(wc_cp_composite_scripts,function(a,b){clearTimeout(b.timers.on_resize_timer),b.timers.on_resize_timer=setTimeout(function(){b.on_resize_handler()},50)})}),a.fn.wc_composite_form=function(){if(!a(this).hasClass("composite_data"))return!0;var b=a(this).data("container_id"),d=a(this).closest(".composite_form");"undefined"!=typeof wc_cp_composite_scripts[b]&&d.find("*").off(),wc_cp_composite_scripts[b]=new c({$composite_form:d,$composite_data:a(this)}),d.data("script_id",b),wc_cp_composite_scripts[b].init()},a(".composite_form .composite_data").each(function(){a(this).wc_composite_form()})})}(jQuery,Backbone);