jQuery(function(a){function b(){var a={formatMatches:function(a){return 1===a?wc_composite_admin_params.i18n_matches_1:wc_composite_admin_params.i18n_matches_n.replace("%qty%",a)},formatNoMatches:function(){return wc_composite_admin_params.i18n_no_matches},formatAjaxError:function(a,b,c){return wc_composite_admin_params.i18n_ajax_error},formatInputTooShort:function(a,b){var c=b-a.length;return 1===c?wc_composite_admin_params.i18n_input_too_short_1:wc_composite_admin_params.i18n_input_too_short_n.replace("%qty%",c)},formatInputTooLong:function(a,b){var c=a.length-b;return 1===c?wc_composite_admin_params.i18n_input_too_long_1:wc_composite_admin_params.i18n_input_too_long_n.replace("%qty%",c)},formatSelectionTooBig:function(a){return 1===a?wc_composite_admin_params.i18n_selection_too_long_1:wc_composite_admin_params.i18n_selection_too_long_n.replace("%qty%",a)},formatLoadMore:function(a){return wc_composite_admin_params.i18n_load_more},formatSearching:function(){return wc_composite_admin_params.i18n_searching}};return a}function c(){a(".bto_groups .bto_group").each(function(b,c){a(".group_position",c).val(parseInt(a(c).index(".bto_groups .bto_group")))})}function d(){var b=a(".bto_groups").find(".bto_group").get();b.sort(function(b,c){var d=parseInt(a(b).attr("rel")),e=parseInt(a(c).attr("rel"));return e>d?-1:d>e?1:0}),a(b).each(function(b,c){a(".bto_groups").append(c)}),a(".bto_groups").sortable({items:".bto_group",cursor:"move",axis:"y",handle:"h3",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,placeholder:"wc-metabox-sortable-placeholder",start:function(a,b){b.item.css("background-color","#f6f6f6")},stop:function(a,b){b.item.removeAttr("style"),c()}})}function e(){a(".bto_scenarios .bto_scenario").each(function(b,c){a(".scenario_position",c).val(parseInt(a(c).index(".bto_scenarios .bto_scenario")))})}function f(){var b=a(".bto_scenarios").find(".bto_scenario").get();b.sort(function(b,c){var d=parseInt(a(b).attr("rel")),e=parseInt(a(c).attr("rel"));return e>d?-1:d>e?1:0}),a(b).each(function(b,c){a(".bto_scenarios").append(c)}),a(".bto_scenarios").sortable({items:".bto_scenario",cursor:"move",axis:"y",handle:"h3",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,placeholder:"wc-metabox-sortable-placeholder",start:function(a,b){b.item.css("background-color","#f6f6f6")},stop:function(a,b){b.item.removeAttr("style"),e()}})}a.fn.wc_cp_chosen_select_component_options=function(){var b=a(this).data("component_id"),c=a(this),d=a(this).data("action");b||(b=a(this).closest(".bto_group").find("input.group_id").val()),a(this).ajaxChosen({method:"GET",url:woocommerce_admin_meta_boxes.ajax_url,dataType:"json",afterTypeDelay:250,data:{action:d,composite_id:woocommerce_admin_meta_boxes.post_id,component_id:b,security:woocommerce_admin_meta_boxes.search_products_nonce}},function(b){var e={};return"woocommerce_json_search_default_component_option"===d&&c.val()>0&&(e[0]=wc_composite_admin_params.i18n_no_default),"woocommerce_json_search_component_options_in_scenario"===d&&("yes"===c.data("component_optional")&&0===c.find('option[value="-1"]').length&&(e[-1]=wc_composite_admin_params.i18n_none),0===c.find('option[value="0"]').length&&(e[0]=wc_composite_admin_params.i18n_all)),a.each(b,function(a,b){0===c.find('option[value="'+a+'"]').length&&(e[a]=b)}),e}),"woocommerce_json_search_component_options_in_scenario"===d&&a(this).on("chosen:showing_dropdown",function(){"yes"===c.data("component_optional")&&0===c.find('option[value="-1"]').length&&a("<option />").attr("value","-1").html(wc_composite_admin_params.i18n_none).prependTo(c),0===c.find('option[value="0"]').length&&a("<option />").attr("value","0").html(wc_composite_admin_params.i18n_all).prependTo(c),c.trigger("chosen:updated")})},a.fn.wc_cp_chosen_select_products=function(){var b=a(this);a(this).ajaxChosen({method:"GET",url:woocommerce_admin_meta_boxes.ajax_url,dataType:"json",afterTypeDelay:250,data:{action:"woocommerce_json_search_products",security:woocommerce_admin_meta_boxes.search_products_nonce}},function(c){var d={};return a.each(c,function(a,c){0===b.find('option[value="'+a+'"]').length&&(d[a]=c)}),d})},a.fn.wc_cp_select2=function(){a(this).find(":input.wc-enhanced-select").filter(":not(.enhanced)").each(function(){var c=a.extend({minimumResultsForSearch:10,allowClear:a(this).data("allow_clear")?!0:!1,placeholder:a(this).data("placeholder")},b());a(this).select2(c).addClass("enhanced")})},a.fn.wc_cp_select2_products=function(){a(this).find(":input.wc-product-search").filter(":not(.enhanced)").each(function(){var c={allowClear:a(this).data("allow_clear")?!0:!1,placeholder:a(this).data("placeholder"),minimumInputLength:a(this).data("minimum_input_length")?a(this).data("minimum_input_length"):"3",escapeMarkup:function(a){return a},ajax:{url:wc_enhanced_select_params.ajax_url,dataType:"json",quietMillis:250,data:function(b,c){return{term:b,action:a(this).data("action")||"woocommerce_json_search_products",security:wc_enhanced_select_params.search_products_nonce}},results:function(b,c){var d=[];return b&&a.each(b,function(a,b){d.push({id:a,text:b})}),{results:d}},cache:!0}};a(this).data("multiple")===!0?(c.multiple=!0,c.initSelection=function(b,c){var d=a.parseJSON(b.attr("data-selected")),e=[];return a(b.val().split(",")).each(function(a,b){e.push({id:b,text:d[b]})}),c(e)},c.formatSelection=function(a){return'<div class="selected-option" data-id="'+a.id+'">'+a.text+"</div>"}):(c.multiple=!1,c.initSelection=function(a,b){var c={id:a.val(),text:a.attr("data-selected")};return b(c)}),c=a.extend(c,b()),a(this).select2(c).addClass("enhanced")})},a.fn.wc_cp_select2_component_options=function(){a(this).find(":input.wc-component-options-search").filter(":not(.enhanced)").each(function(){var c=a(this).data("component_id"),d=a(this).data("action"),e=a(this);c||(c=a(this).closest(".bto_group").find("input.group_id").val());var f={allowClear:a(this).data("allow_clear")?!0:!1,placeholder:a(this).data("placeholder"),minimumInputLength:a(this).data("minimum_input_length")?a(this).data("minimum_input_length"):"3",escapeMarkup:function(a){return a},ajax:{url:wc_enhanced_select_params.ajax_url,dataType:"json",quietMillis:250,data:function(a,b){return{term:a,action:d,composite_id:woocommerce_admin_meta_boxes.post_id,component_id:c,security:woocommerce_admin_meta_boxes.search_products_nonce}},results:function(b,c){var f=[];return"woocommerce_json_search_component_options_in_scenario"===d&&("yes"===e.data("component_optional")&&0===e.find('option[value="-1"]').length&&f.push({id:"-1",text:wc_composite_admin_params.i18n_none}),0===e.find('option[value="0"]').length&&f.push({id:"0",text:wc_composite_admin_params.i18n_all})),b&&a.each(b,function(a,b){f.push({id:a,text:b})}),{results:f}},cache:!0}};a(this).data("multiple")===!0?(f.multiple=!0,f.initSelection=function(b,c){var d=a.parseJSON(b.attr("data-selected")),e=[];return a(b.val().split(",")).each(function(a,b){e.push({id:b,text:d[b]})}),c(e)},f.formatSelection=function(a){return'<div class="selected-option" data-id="'+a.id+'">'+a.text+"</div>"}):(f.multiple=!1,f.initSelection=function(a,b){var c={id:a.val(),text:a.attr("data-selected")};return b(c)}),f=a.extend(f,b()),a(this).select2(f).addClass("enhanced")})};var g={};g="yes"===wc_composite_admin_params.is_wc_version_gte_2_3?{message:null,overlayCSS:{background:"#fff",opacity:.6}}:{message:null,overlayCSS:{background:"#fff url("+woocommerce_admin_meta_boxes.plugin_url+"/assets/images/ajax-loader.gif) no-repeat center",opacity:.6}},a(".bto_base_pricing").insertBefore(".pricing"),a(".composite_stock_msg").insertBefore("._manage_stock_field"),a("p._sold_individually_field").addClass("hide_if_composite"),"undefined"==typeof woocommerce_admin_meta_boxes&&(woocommerce_admin_meta_boxes=woocommerce_writepanel_params),a("body").on("woocommerce-product-type-change",function(b,c,d){"composite"===c&&(a("input#_downloadable").prop("checked",!1),a("input#_virtual").prop("checked",!1),a(".show_if_simple").not("._sold_individually_field").show(),a(".show_if_external").hide(),a(".show_if_composite").show(),a("input#_downloadable").closest(".show_if_simple").hide(),a("input#_virtual").closest(".show_if_simple").hide(),a("input#_manage_stock").change(),a("input#_per_product_pricing_bto").change(),a("input#_per_product_shipping_bto").change(),a("#_nyp").change())}),a("select#product-type").change(),a("input#_per_product_shipping_bto").change(function(){"composite"===a("select#product-type").val()&&(a("input#_per_product_shipping_bto").is(":checked")?(a(".show_if_virtual").show(),a(".hide_if_virtual").hide(),a(".shipping_tab").hasClass("active")&&a("ul.product_data_tabs li:visible").eq(0).find("a").click()):(a(".show_if_virtual").hide(),a(".hide_if_virtual").show()))}).change(),a("input#_per_product_pricing_bto").change(function(){"composite"===a("select#product-type").val()&&(a(this).is(":checked")?(a("#_regular_price").val(""),a("#_sale_price").val(""),a("._tax_class_field").closest(".options_group").show(),a(".pricing").hide(),a(".bto_base_pricing").show(),a("#bto_product_data .config_group .bto_groups .bto_group").each(function(){a(this).find(".bto_group_data .group_discount input.group_discount").attr("disabled",!1),a(this).find(".bto_group_data .group_discount").show()})):(a("._tax_class_field").closest(".options_group").show(),a("#_nyp").is(":checked")||a(".pricing").show(),a(".bto_base_pricing").hide(),a("#bto_product_data .config_group .bto_groups .bto_group").each(function(){a(this).find(".bto_group_data .group_discount input.group_discount").attr("disabled","disabled"),a(this).find(".bto_group_data .group_discount").hide()})))}).change(),a("#_nyp").change(function(){"composite"===a("select#product-type").val()&&(a("#_nyp").is(":checked")?(a("input#_per_product_pricing_bto").prop("checked",!1),a(".bto_per_item_pricing").hide()):a(".bto_per_item_pricing").show(),a("input#_per_product_pricing_bto").change())}).change(),a("#bto_product_data .bundle_group .bto_layouts").on("click",".bto_layout_label",function(){a(this).closest(".bto_layouts").find(".selected").removeClass("selected"),a(this).addClass("selected")}),a("#bto_product_data .config_group").on("click",".subsubsub a",function(){a(this).closest(".subsubsub").find("a").removeClass("current"),a(this).addClass("current"),a(this).closest(".bto_group_data").find(".options_group").addClass("options_group_hidden");var b=a(this).data("tab");return a(this).closest(".bto_group_data").find(".options_group_"+b).removeClass("options_group_hidden"),!1}),a("#bto_product_data .config_group").on("click","button.remove_row",function(){var b=a(this).parent().parent();b.find("*").off(),b.remove(),c()}),a("#bto_product_data .config_group").on("keyup","input.group_title",function(){a(this).closest(".bto_group").find("h3 .group_name").text(a(this).val())}),a("#bto_product_data .config_group").on("click",".expand_all",function(){return a(this).closest(".wc-metaboxes-wrapper").find(".wc-metabox > .bto_group_data").show(),!1}),a("#bto_product_data .config_group").on("click",".close_all",function(){return a(this).closest(".wc-metaboxes-wrapper").find(".wc-metabox > .bto_group_data").hide(),!1}),a("#bto_product_data .config_group").on("change","select.bto_query_type",function(){var b=a(this).val();a(this).closest(".bto_group").find(".bto_query_type_selector").hide(),a(this).closest(".bto_group").find(".bto_query_type_"+b).show()}),a("#bto_product_data .config_group select.bto_query_type").change(),a("#bto_product_data .config_group").on("change",".group_show_filters input",function(){a(this).is(":checked")?a(this).closest(".bto_group").find(".group_filters").show():a(this).closest(".bto_group").find(".group_filters").hide()}),a("#bto_product_data .config_group .group_show_filters input").change(),"yes"===wc_composite_admin_params.is_wc_version_gte_2_3?a("#bto_product_data .config_group, #bto_scenario_data .bto_scenarios").wc_cp_select2_component_options():a("#bto_product_data .config_group select.ajax_chosen_select_component_options, #bto_scenario_data select.ajax_chosen_select_component_options").each(function(){a(this).wc_cp_chosen_select_component_options()});var h=a(".bto_groups .bto_group").size();a("#bto_product_data").on("click","button.add_bto_group",function(){a("#bto_product_data").block(g),h++;var b={action:"woocommerce_add_composite_component",post_id:woocommerce_admin_meta_boxes.post_id,id:h,security:wc_composite_admin_params.add_component_nonce};return a.post(woocommerce_admin_meta_boxes.ajax_url,b,function(b){a("#bto_config_group_inner .bto_groups").append(b);var c=a("#bto_config_group_inner .bto_groups .bto_group").last();"yes"===wc_composite_admin_params.is_wc_version_gte_2_3?(c.wc_cp_select2(),c.wc_cp_select2_products()):(c.find(".ajax_chosen_select_products").wc_cp_chosen_select_products(),c.find(".chosen_select").chosen()),a("input#_per_product_pricing_bto").change(),c.find("select.bto_query_type").change(),c.find(".group_show_filters input").change(),c.find(".woocommerce-help-tip").tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200}),a("#bto_product_data").unblock(),c.trigger("woocommerce_bto_component_added")}),!1}),a("#bto_scenario_data #bto_scenarios_inner").on("click","button.remove_row",function(){var b=a(this).parent().parent();b.find("*").off(),b.remove(),e()}),a("#bto_scenario_data #bto_scenarios_inner").on("keyup","input.scenario_title",function(){a(this).closest(".bto_scenario").find("h3 .scenario_name").text(a(this).val())}),a("#bto_scenario_data #bto_scenarios_inner").on("click",".expand_all",function(){return a(this).closest(".wc-metaboxes-wrapper").find(".wc-metabox > .bto_scenario_data").show(),!1}),a("#bto_scenario_data #bto_scenarios_inner").on("click",".close_all",function(){return a(this).closest(".wc-metaboxes-wrapper").find(".wc-metabox > .bto_scenario_data").hide(),!1}),a("#bto_scenario_data #bto_scenarios_inner").on("change","select.bto_scenario_exclude",function(){"masked"===a(this).val()?a(this).closest(".bto_scenario_selector").find(".bto_scenario_selector_inner").slideUp(200):a(this).closest(".bto_scenario_selector").find(".bto_scenario_selector_inner").slideDown(200)});var i=a(".bto_scenarios .bto_scenario").size();a("#bto_scenario_data").on("click","button.add_bto_scenario",function(){a("#bto_scenario_data").block(g),i++;var b={action:"woocommerce_add_composite_scenario",post_id:woocommerce_admin_meta_boxes.post_id,id:i,security:wc_composite_admin_params.add_scenario_nonce};return a.post(woocommerce_admin_meta_boxes.ajax_url,b,function(b){a("#bto_scenarios_inner .bto_scenarios").append(b);var c=a(".bto_scenario_"+i);"yes"===wc_composite_admin_params.is_wc_version_gte_2_3?(c.wc_cp_select2(),c.wc_cp_select2_component_options()):(c.find(".bto_scenario_ids").each(function(){a(this).chosen()}),c.find(".ajax_chosen_select_component_options").each(function(){a(this).wc_cp_chosen_select_component_options()})),c.find(".tips, .woocommerce-help-tip").tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200}),a("#bto_scenario_data").unblock(),c.trigger("woocommerce_bto_scenario_added")}),!1}),d(),f(),a(".save_composition").on("click",function(){a("#bto_product_data, #bto_scenario_data").block(g),a(".bto_groups .bto_group").find("*").off();var b={post_id:woocommerce_admin_meta_boxes.post_id,data:a("#bto_product_data, #bto_scenario_data").find("input, select, textarea").serialize(),action:"woocommerce_bto_composite_save",security:wc_composite_admin_params.save_composite_nonce};a.post(woocommerce_admin_meta_boxes.ajax_url,b,function(b){var c=window.location.toString();c=c.replace("post-new.php?","post.php?post="+woocommerce_admin_meta_boxes.post_id+"&action=edit&"),a.get(c,function(c){a("#bto_product_data #bto_config_group_inner").html(a(c).find("#bto_config_group_inner").html()),a("#bto_scenario_data #bto_scenarios_inner").html(a(c).find("#bto_scenarios_inner").html()),d(),f(),a("#bto_product_data .woocommerce-help-tip, #bto_scenario_data .woocommerce-help-tip, #bto_scenario_data .tips").tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200}),a("#bto_config_group_inner .bto_groups, #bto_scenarios_inner .bto_scenarios").find(".wc-metabox-content").hide(),a("input#_per_product_pricing_bto").change(),a("#bto_config_group_inner select.bto_query_type").change(),a("#bto_config_group_inner .group_show_filters input").change(),"yes"===wc_composite_admin_params.is_wc_version_gte_2_3?(a("#bto_config_group_inner, #bto_scenarios_inner").wc_cp_select2(),a("#bto_config_group_inner").wc_cp_select2_products(),a("#bto_config_group_inner, #bto_scenarios_inner").wc_cp_select2_component_options()):(a("#bto_config_group_inner select.chosen_select, #bto_scenarios_inner select.chosen_select").chosen(),a("#bto_config_group_inner .bto_group_data .bto_selector select").each(function(){a(this).wc_cp_chosen_select_products()}),a("#bto_config_group_inner .bto_group_data .default_selector select.ajax_chosen_select_component_options, #bto_scenario_data select.ajax_chosen_select_component_options").each(function(){a(this).wc_cp_chosen_select_component_options()})),b.length>0&&a.each(b,function(a,b){window.alert(b)}),a("#bto_product_data, #bto_scenario_data").unblock()})},"json")})});